<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>çœŸå¿ƒè©±å¤§å†’éšª v1.0 è±å¯Œå®Œæ•´ä¸”è¶£å‘³çš„çœŸå¿ƒè©±å¤§å†’éšªç¶²ç«™</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
      /* =========================================
           1. CSS Variables & Base
           ========================================= */
      :root {
        --gold: #d4af37;
        --gold-light: #f4df87;
        --gold-dark: #aa8c2c;
        --black: #121212;
        --dark-grey: #1e1e1e;
        --text-main: #e0e0e0;
        --silver: #c0c0c0;
        --bronze: #cd7f32;
        --adult-pink: #e91e63;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.8);
        --transition: all 0.3s ease;

        --sidebar-width: 240px;
        --sidebar-width-collapsed: 80px;
      }

      * {
        box-sizing: border-box;
        user-select: none;
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      *::-webkit-scrollbar {
        display: none;
      }

      body {
        font-family: "Noto Sans TC", sans-serif;
        background: radial-gradient(circle at center, #2a2a2a 0%, #000000 100%);
        color: var(--text-main);
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }

      body::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: repeating-linear-gradient(
          45deg,
          rgba(212, 175, 55, 0.05) 0px,
          rgba(212, 175, 55, 0.05) 1px,
          transparent 1px,
          transparent 20px
        );
        z-index: -1;
        pointer-events: none;
      }

      /* =========================================
           2. Layout: Header
           ========================================= */
      header {
        text-align: center;
        padding: 15px;
        border-bottom: 2px solid var(--gold-dark);
        background: rgba(0, 0, 0, 0.8);
        box-shadow: var(--shadow);
        z-index: 10;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #menu-toggle {
        display: none;
        position: absolute;
        left: 20px;
        background: none;
        border: none;
        color: var(--gold);
        cursor: pointer;
        padding: 8px;
        border-radius: 5px;
        transition: var(--transition);
      }
      #menu-toggle:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      #menu-toggle i {
        font-size: 28px;
      }

      header h1 {
        margin: 0;
        color: var(--gold);
        font-weight: 700;
        letter-spacing: 2px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        font-size: 1.5rem;
      }

      header .audio-controls {
        position: absolute;
        right: 15px;
        z-index: 20;
      }

      header .audio-controls .audio-btn {
        background: none;
        border: none;
        color: var(--gold);
        cursor: pointer;
        padding: 5px;
      }

      /* =========================================
           3. Layout: Mobile Nav
           ========================================= */
      nav {
        display: flex;
        justify-content: space-around;
        background: var(--dark-grey);
        padding: 10px 0;
        border-top: 2px solid var(--gold-dark);
        z-index: 10;
      }

      nav .nav-btn {
        background: none;
        border: none;
        color: #666;
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        transition: var(--transition);
        width: 100%;
      }

      nav .nav-btn i {
        font-size: 24px;
        margin-bottom: 4px;
      }
      nav .nav-btn span {
        font-size: 12px;
      }

      nav .nav-btn.active,
      nav .nav-btn:hover {
        color: var(--gold);
        text-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
      }

      main {
        flex: 1;
        position: relative;
        overflow: hidden;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
      }

      /* =========================================
           4. Panel Transitions
           ========================================= */
      .panel {
        position: absolute;
        inset: 0;
        padding: 20px;
        overflow-y: auto;
        opacity: 0;
        transform: translateX(20px);
        pointer-events: none;
        transition: var(--transition);
        background: transparent;
      }

      .panel.active {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
        z-index: 5;
      }

      /* =========================================
           5. Components
           ========================================= */
      .wheel-container {
        position: relative;
        width: 300px;
        height: 300px;
        margin: 20px auto;
        border-radius: 50%;

        padding: 8px;
        background: conic-gradient(
          #ff0000,
          #ff7f00,
          #ffff00,
          #00ff00,
          #0000ff,
          #4b0082,
          #9400d3,
          #ff0000
        );

        box-shadow: 0 0 20px rgba(255, 0, 0, 0.4), 0 0 40px rgba(0, 255, 0, 0.3),
          0 0 60px rgba(0, 0, 255, 0.2);
      }

      .wheel-container canvas {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        position: relative;
        z-index: 1;
      }

      .wheel-container .pointer {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 15px solid transparent;
        border-right: 15px solid transparent;
        border-top: 30px solid white;
        z-index: 2;
        filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
      }
      .wheel-container .center-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        background: radial-gradient(circle, var(--gold-light), var(--gold));
        border-radius: 50%;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        border: 2px solid #fff;
        z-index: 2;
      }

      .game-info {
        text-align: center;
        margin-top: 20px;
        background: rgba(0, 0, 0, 0.6);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid var(--gold-dark);
        transition: background 0.5s ease;
      }
      .game-info .current-player {
        color: var(--gold-light);
        font-size: 1.2rem;
        margin-bottom: 10px;
      }
      .game-info .current-player i {
        vertical-align: bottom;
      }
      .game-info .result-box {
        min-height: 60px;
        font-size: 1.1rem;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
      }

      .btn-main {
        background: linear-gradient(to bottom, var(--gold), var(--gold-dark));
        color: var(--black);
        border: none;
        padding: 15px 40px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 30px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        margin: 20px auto;
        display: block;
        width: 80%;
        transition: transform 0.1s;
      }
      .btn-main:active {
        transform: scale(0.95);
      }
      .btn-main:disabled {
        filter: grayscale(1);
        cursor: not-allowed;
      }

      .btn-small {
        background: var(--gold-dark);
        color: #fff;
        border: none;
        padding: 0 15px;
        border-radius: 5px;
        cursor: pointer;
        height: 38px;
      }
      .btn-small.btn-danger {
        background: #8b0000;
      }
      .btn-small.btn-ai {
        background: linear-gradient(45deg, #1e90ff, #00bfff);
        color: white;
      }
      .btn-small.btn-outline {
        background: transparent;
        border: 1px solid var(--gold);
        color: var(--gold);
      }
      .btn-small.btn-outline:hover {
        background: rgba(212, 175, 55, 0.1);
      }

      .section-title {
        color: var(--gold);
        border-bottom: 1px solid var(--gold-dark);
        padding-bottom: 5px;
        margin-bottom: 15px;
        font-size: 1.1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }
      .input-group.input-group--options {
        margin-top: -10px;
      }
      .input-group.input-group--options label {
        color: #888;
        font-size: 0.8rem;
        align-self: center;
      }

      input,
      select {
        flex: 1;
        background: #f9f9f9;
        border: 1px solid var(--gold-dark);
        color: #000000;
        padding: 10px;
        border-radius: 5px;
        font-family: inherit;
        font-weight: 500;
      }
      input::placeholder {
        color: #666;
      }
      option {
        background: #fff;
        color: #000;
      }
      input:focus,
      select:focus {
        outline: none;
        border-color: var(--gold);
        box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
      }

      .list-container {
        max-height: 60vh;
        overflow-y: auto;
      }
      .list-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 3px solid transparent;
      }
      .list-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      .list-item.truth {
        border-left-color: #4caf50;
      }
      .list-item.dare {
        border-left-color: #ff5722;
      }
      .list-item.pass {
        border-left-color: #c0c0c0;
      }

      .list-item .tag {
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 5px;
        background: #333;
        color: #fff;
      }
      .list-item .tag.level-adult {
        background: var(--adult-pink);
        font-weight: bold;
      }

      .list-item .delete-btn {
        background: none;
        border: none;
        color: #ff6b6b;
        cursor: pointer;
      }

      /* Rank Styles */
      .rank-1 {
        border-left: 3px solid var(--gold);
        background: linear-gradient(
          90deg,
          rgba(212, 175, 55, 0.2),
          transparent
        );
      }
      .rank-1 .rank-icon {
        color: var(--gold);
        font-size: 1.2rem;
      }
      .rank-2 {
        border-left: 3px solid var(--silver);
        background: linear-gradient(
          90deg,
          rgba(192, 192, 192, 0.15),
          transparent
        );
      }
      .rank-2 .rank-icon {
        color: var(--silver);
        font-size: 1.2rem;
      }
      .rank-3 {
        border-left: 3px solid var(--bronze);
        background: linear-gradient(
          90deg,
          rgba(205, 127, 50, 0.15),
          transparent
        );
      }
      .rank-3 .rank-icon {
        color: var(--bronze);
        font-size: 1.2rem;
      }
      .rank-count {
        font-weight: bold;
        color: var(--gold);
        margin-left: 10px;
      }

      /* Timer Styles */
      .timer-display-box {
        text-align: center;
        margin: 30px 0;
        position: relative;
      }
      .timer-time {
        font-size: 5rem;
        font-weight: 700;
        color: var(--gold);
        text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        font-variant-numeric: tabular-nums;
        line-height: 1;
      }
      .timer-controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }
      .timer-btn-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid var(--gold);
        background: rgba(0, 0, 0, 0.5);
        color: var(--gold);
        font-size: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      .timer-btn-circle:hover {
        background: var(--gold);
        color: #000;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
      }
      .timer-btn-circle:active {
        transform: scale(0.95);
      }
      .timer-presets {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }
      .timer-blink {
        animation: blink 1s infinite;
        color: #ff5722;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      .difficulty-tabs {
        display: flex;
        margin-bottom: 10px;
        background: #222;
        border-radius: 5px;
        padding: 2px;
      }
      .difficulty-tabs .diff-tab {
        flex: 1;
        text-align: center;
        padding: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        color: #888;
      }
      .difficulty-tabs .diff-tab.active {
        background: var(--gold-dark);
        color: #fff;
        border-radius: 4px;
      }

      .slider-container {
        margin-bottom: 20px;
      }
      .slider-container label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        color: #aaa;
      }
      .slider-container input[type="range"] {
        width: 100%;
        cursor: pointer;
        accent-color: var(--gold);
      }
      .slider-container select {
        width: 100%;
      }

      /* =========================================
           6. RWD: Desktop Layout
           ========================================= */
      @media (min-width: 768px) {
        body {
          display: grid;
          grid-template-columns: var(--sidebar-width) 1fr;
          grid-template-rows: auto 1fr;
          grid-template-areas: "sidebar header" "sidebar main";
          transition: grid-template-columns 0.3s ease;
        }

        body.sidebar-collapsed {
          grid-template-columns: var(--sidebar-width-collapsed) 1fr;
        }
        body.sidebar-collapsed nav .nav-btn span {
          display: none;
        }
        body.sidebar-collapsed nav::before {
          opacity: 0;
        }
        body.sidebar-collapsed nav .nav-btn {
          padding: 18px 0;
          justify-content: center;
          border-left: none;
          border-right: 4px solid transparent;
        }
        body.sidebar-collapsed nav .nav-btn i {
          margin-bottom: 0;
        }
        body.sidebar-collapsed nav .nav-btn.active {
          border-right-color: var(--gold);
          border-left-color: transparent;
          background: rgba(212, 175, 55, 0.1);
        }

        nav {
          grid-area: sidebar;
        }
        header {
          grid-area: header;
        }
        main {
          grid-area: main;
        }

        header {
          justify-content: center;
          padding-left: 0;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
          z-index: 20;
        }
        #menu-toggle {
          display: block;
        }

        main {
          max-width: 100%;
          padding: 0px 40px;
          display: flex;
          justify-content: center;
        }
        main .panel {
          max-width: 800px;
          position: relative;
          margin: 0 auto;
          transform: none;
          opacity: 0;
          display: none;
        }
        main .panel.active {
          opacity: 1;
          transform: none;
          display: block;
          animation: fadeIn 0.5s ease;
        }

        nav {
          flex-direction: column;
          justify-content: flex-start;
          border-top: none;
          border-right: 2px solid var(--gold-dark);
          padding-top: 20px;
          background: var(--dark-grey);
          height: 100vh;
          transition: width 0.3s ease;
          overflow: hidden;
        }
        nav::before {
          content: "MENU";
          display: block;
          text-align: center;
          color: #666;
          font-size: 0.8rem;
          letter-spacing: 2px;
          margin-bottom: 20px;
          padding-bottom: 10px;
          border-bottom: 1px solid rgba(255, 255, 255, 0.05);
          width: 80%;
          margin-left: auto;
          margin-right: auto;
          transition: opacity 0.3s ease;
          white-space: nowrap;
        }
        nav .nav-btn {
          flex-direction: row;
          padding: 18px 30px;
          width: 100%;
          justify-content: flex-start;
          gap: 20px;
          border-left: 4px solid transparent;
          white-space: nowrap;
        }
        nav .nav-btn i {
          font-size: 24px;
          margin-bottom: 0;
          min-width: 24px;
          text-align: center;
        }
        nav .nav-btn span {
          font-size: 16px;
          font-weight: 500;
          transition: opacity 0.2s ease;
        }
        nav .nav-btn:hover {
          background: rgba(255, 255, 255, 0.05);
          color: var(--text-main);
        }
        nav .nav-btn.active {
          background: linear-gradient(
            90deg,
            rgba(212, 175, 55, 0.15),
            transparent
          );
          color: var(--gold);
          border-left-color: var(--gold);
          text-shadow: none;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <audio id="bgm" loop><source src="bgm.mp3" type="audio/mpeg" /></audio>
    <audio id="sfx-spin"><source src="spin.mp3" type="audio/mpeg" /></audio>
    <audio id="sfx-win"><source src="win.mp3" type="audio/mpeg" /></audio>

    <header>
      <button id="menu-toggle"><i class="material-icons">menu</i></button>
      <h1>çœŸå¿ƒè©±å¤§å†’éšª v1.0</h1>
      <div class="audio-controls">
        <button class="audio-btn" id="musicToggle">
          <i class="material-icons">music_off</i>
        </button>
      </div>
    </header>

    <main>
      <section id="panel-home" class="panel active">
        <div class="wheel-container">
          <div class="pointer"></div>
          <div class="center-circle"></div>
          <canvas id="wheelCanvas" width="300" height="300"></canvas>
        </div>
        <div class="game-info">
          <div class="current-player" id="display-player">
            <i class="material-icons">person</i>
            <span id="player-name-slot">æº–å‚™é–‹å§‹</span>
          </div>
          <div class="result-box" id="display-result">
            é»æ“ŠæŒ‰éˆ•æˆ–æŒ‰ç©ºç™½éµæ—‹è½‰
          </div>
        </div>
        <button id="spinBtn" class="btn-main">é–‹å§‹æ—‹è½‰</button>
      </section>

      <section id="panel-players" class="panel">
        <div class="section-title">
          <span>ç©å®¶åå–® (<span id="player-count">0</span>)</span>
        </div>
        <div class="input-group">
          <input
            type="text"
            id="new-player-input"
            placeholder="è¼¸å…¥ç©å®¶åç¨±..."
          />
          <button id="add-player-btn" class="btn-small">
            <i class="material-icons">add</i>
          </button>
        </div>
        <div id="player-list" class="list-container"></div>
      </section>

      <section id="panel-questions" class="panel">
        <div class="section-title">
          <span>å•é¡Œåº«</span>
          <div>
            <button
              id="clear-q-btn"
              class="btn-small btn-danger"
              style="margin-right: 5px"
            >
              <i class="material-icons">delete_sweep</i> æ¸…ç©º
            </button>
            <button id="ai-generate-btn" class="btn-small btn-ai">
              <i class="material-icons">auto_awesome</i> AI ç”¢ç”Ÿ
            </button>
          </div>
        </div>
        <div class="difficulty-tabs" id="diff-selector">
          <div class="diff-tab active" data-val="all">å…¨éƒ¨</div>
          <div class="diff-tab" data-val="truth">çœŸå¿ƒè©±</div>
          <div class="diff-tab" data-val="dare">å¤§å†’éšª</div>
        </div>
        <div class="input-group">
          <select id="q-type" style="flex: 0.4">
            <option value="truth">çœŸå¿ƒè©±</option>
            <option value="dare">å¤§å†’éšª</option>
          </select>
          <input type="text" id="new-q-input" placeholder="è¼¸å…¥å•é¡Œ..." />
          <button id="add-q-btn" class="btn-small">
            <i class="material-icons">add</i>
          </button>
        </div>
        <div class="input-group input-group--options">
          <label>é›£åº¦:</label>
          <select id="q-difficulty">
            <option value="Easy">ç°¡å–®</option>
            <option value="Normal">æ™®é€š</option>
            <option value="Hard">å›°é›£</option>
            <option value="Adult">å¤§äººå°ˆå±¬</option>
          </select>
        </div>
        <div id="question-list" class="list-container"></div>
      </section>

      <section id="panel-leaderboard" class="panel">
        <div class="section-title">
          <span>è¢«é¸ä¸­æ¬¡æ•¸æ’è¡Œ</span>
          <button id="reset-stats-btn" class="btn-small btn-danger">
            é‡ç½®
          </button>
        </div>
        <div id="leaderboard-list" class="list-container"></div>
      </section>

      <section id="panel-timer" class="panel">
        <div class="section-title">
          <span>è¨ˆæ™‚å™¨</span>
        </div>
        <div class="difficulty-tabs" id="timer-mode-selector">
          <div class="diff-tab active" data-mode="countdown">å€’æ•¸è¨ˆæ™‚</div>
          <div class="diff-tab" data-mode="stopwatch">è¨ˆæ™‚ç¢¼éŒ¶</div>
        </div>

        <div class="timer-display-box">
          <div id="timer-display" class="timer-time">01:00</div>
        </div>

        <div
          class="timer-presets"
          id="timer-presets-container"
          style="display: flex"
        >
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(10)"
          >
            +10s
          </button>
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(30)"
          >
            +30s
          </button>
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(60)"
          >
            +1m
          </button>
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(300)"
          >
            +5m
          </button>
        </div>

        <div class="timer-controls">
          <button
            class="timer-btn-circle"
            id="timer-btn-reset"
            title="é‡ç½®"
            onclick="TimerModule.reset()"
          >
            <i class="material-icons">replay</i>
          </button>
          <button
            class="timer-btn-circle"
            id="timer-btn-start"
            title="é–‹å§‹/æš«åœ"
            style="background: var(--gold); color: #000"
            onclick="TimerModule.toggle()"
          >
            <i class="material-icons" id="timer-icon-play">play_arrow</i>
          </button>
        </div>
      </section>

      <section id="panel-history" class="panel">
        <div class="section-title">
          <span>æ­·å²è¨˜éŒ„</span>
          <button id="clear-history-btn" class="btn-small btn-danger">
            æ¸…é™¤
          </button>
        </div>
        <div id="history-list" class="list-container"></div>
      </section>

      <section id="panel-settings" class="panel">
        <div class="section-title">è½‰ç›¤é…ç½® (ç«‹å³ç”Ÿæ•ˆ)</div>
        <div class="slider-container">
          <label>çœŸå¿ƒè©±æ ¼æ•¸ <span id="val-truth">10</span></label>
          <input type="range" id="range-truth" min="0" max="50" value="10" />
        </div>
        <div class="slider-container">
          <label>å¤§å†’éšªæ ¼æ•¸ <span id="val-dare">10</span></label>
          <input type="range" id="range-dare" min="0" max="50" value="10" />
        </div>
        <div class="slider-container">
          <label>ä¸‹é¢ä¸€ä½(Pass)æ ¼æ•¸ <span id="val-pass">2</span></label>
          <input type="range" id="range-pass" min="0" max="50" value="2" />
        </div>

        <div class="section-title" style="margin-top: 30px">éŠæˆ²ç‰©ç†</div>
        <div class="slider-container">
          <label>æ—‹è½‰é€Ÿåº¦</label>
          <input type="range" id="speed-range" min="10" max="50" value="30" />
        </div>
        <div class="slider-container">
          <label>æ—‹è½‰æ™‚é–“ (ç§’)</label>
          <input type="range" id="duration-range" min="2" max="10" value="5" />
        </div>
        <div class="slider-container">
          <label>é›£åº¦ç¯©é¸</label>
          <select id="game-difficulty-filter">
            <option value="Any">ä»»æ„ (åŒ…å«æ‰€æœ‰)</option>
            <option value="Normal">æ™®é€šä»¥ä¸Š (åŒ…å«å›°é›£èˆ‡å¤§äºº)</option>
            <option value="Hard">åˆºæ¿€æ¨¡å¼ (å›°é›£èˆ‡å¤§äºº)</option>
            <option value="Adult">åƒ…é™å¤§äºº (18+)</option>
          </select>
        </div>

        <div class="section-title" style="margin-top: 30px">è³‡æ–™å‚™ä»½</div>
        <div class="input-group" style="justify-content: space-between">
          <button
            id="btn-export"
            class="btn-small"
            style="flex: 1; margin-right: 5px"
          >
            <i class="material-icons">download</i> åŒ¯å‡ºå‚™ä»½
          </button>
          <button
            id="btn-import"
            class="btn-small btn-outline"
            style="flex: 1; margin-left: 5px"
          >
            <i class="material-icons">upload</i> åŒ¯å…¥å‚™ä»½
          </button>
          <input
            type="file"
            id="file-import"
            style="display: none"
            accept=".json"
          />
        </div>
      </section>
    </main>

    <nav>
      <button
        class="nav-btn active"
        onclick="UIModule.switchPanel('panel-home', this)"
      >
        <i class="material-icons">casino</i><span>éŠæˆ²</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-players', this)"
      >
        <i class="material-icons">group</i><span>ç©å®¶</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-leaderboard', this)"
      >
        <i class="material-icons">emoji_events</i><span>æ’è¡Œ</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-timer', this)"
      >
        <i class="material-icons">timer</i><span>è¨ˆæ™‚</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-questions', this)"
      >
        <i class="material-icons">edit_note</i><span>å•é¡Œ</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-history', this)"
      >
        <i class="material-icons">history</i><span>è¨˜éŒ„</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-settings', this)"
      >
        <i class="material-icons">settings</i><span>è¨­å®š</span>
      </button>
    </nav>

    <script>
      /* ==================== Data Module ==================== */
      const DataModule = {
        key: "luxuryTOD_data_v1_final", // æ›´æ–° Key
        defaultDB: [
          // ğŸŸ¢ Level 1: Easy Truth (Simple)
          {
            type: "truth",
            content: "ä½ çš„æ‰‹æ©Ÿæ¡Œå¸ƒæ˜¯ä»€éº¼ï¼Ÿç‚ºä»€éº¼é¸é€™å¼µï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "å¦‚æœä¸­æ¨‚é€é ­çï¼Œç¬¬ä¸€ä»¶äº‹åšä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "ä½ ç¡è¦ºæœ‰ä»€éº¼æ€ªç™–ï¼Ÿï¼ˆæ‰“å‘¼ã€æµå£æ°´ã€æŠ±è¢«å­...ï¼‰",
            level: "Easy",
          },
          { type: "truth", content: "æœ€è¿‘ä¸€æ¬¡å“­æ˜¯å› ç‚ºä»€éº¼ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±åƒå“ªç¨®å‹•ç‰©ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "ä½ æœ€æ€•å“ªç¨®æ˜†èŸ²æˆ–å‹•ç‰©ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœèƒ½æœ‰è¶…èƒ½åŠ›ï¼Œä½ æƒ³è¦ä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "å°æ™‚å€™çš„å¤¢æƒ³è·æ¥­æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "å»KTVå¿…é»çš„ä¸€é¦–æ­Œæ˜¯ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "æ´—æ¾¡æ™‚æœƒåšçš„æœ€å¥‡æ€ªçš„ä¸€ä»¶äº‹ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "èº«ä¸Šå“ªå€‹éƒ¨ä½æœ€æ»¿æ„ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "èªªå‡ºä¸€å€‹ä½ çµ•å°ä¸æ•¢åƒçš„é£Ÿç‰©ã€‚",
            level: "Easy",
          },
          { type: "truth", content: "ä½ è¦ºå¾—åœ¨å ´èª°æœ€è‡ªæˆ€ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "ä¸Šä¸€æ¬¡å°¿åºŠæ˜¯å¹¾æ­²ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "è²·éæœ€å¾Œæ‚”çš„æ±è¥¿æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœæ˜å¤©æ˜¯ä¸–ç•Œæœ«æ—¥ï¼Œä½ æœƒåƒä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "ä½ ç›¸ä¿¡é€™ä¸–ä¸Šæœ‰é¬¼å—ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "åšéæœ€å¥‡æ€ªçš„å¤¢æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "ä½ çš„æ‹¿æ‰‹èœæ˜¯ä»€éº¼ï¼Ÿï¼ˆæ³¡éºµä¹Ÿç®—ï¼‰",
            level: "Easy",
          },
          { type: "truth", content: "æœ€å–œæ­¡çš„ä¸€éƒ¨é›»å½±æ˜¯ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±å¿ƒç†å¹´é½¡å¹¾æ­²ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœå¯ä»¥è·Ÿåœ¨å ´ä¸€äººäº¤æ›èº«ä»½ä¸€å¤©ï¼Œæƒ³é¸èª°ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "èªªå‡ºä¸€ä»¶ä½ å°æ™‚å€™åšéçš„è ¢äº‹ã€‚",
            level: "Easy",
          },
          {
            type: "truth",
            content: "ä½ æœ‰å¤šå°‘å¤©æ²’æ´—é ­çš„æœ€é«˜ç´€éŒ„ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "è¦ºå¾—åœ¨å ´èª°çœ‹èµ·ä¾†è„¾æ°£æœ€å¥½ï¼Ÿ",
            level: "Easy",
          },

          // ğŸŸ¢ Level 1: Easy Dare (Simple)
          { type: "dare", content: "åšé¬¼è‡‰è‡ªæ‹ä¸€å¼µã€‚", level: "Easy" },
          { type: "dare", content: "æ¨¡ä»¿ä¸€ç¨®å‹•ç‰©çš„å«è²ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "å°è‘—çª—å¤–å¤§å–Šï¼šã€Œæˆ‘æ˜¯ç¬¨è›‹ï¼ã€",
            level: "Easy",
          },
          {
            type: "dare",
            content: "åŸåœ°è½‰ 10 åœˆï¼Œç„¶å¾Œèµ°ç›´ç·šã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ æ‰‹æ©Ÿè£¡ç¬¬ 5 å¼µç…§ç‰‡ã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "ç”¨ã€Œå–µã€ä»£æ›¿ã€Œæˆ‘ã€èªªè©±ä¸‰åˆ†é˜ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "æ¨¡ä»¿åœ¨å ´æŸå€‹äººçš„å£é ­ç¦ªã€‚", level: "Easy" },
          { type: "dare", content: "èª‡çå³é‚Šçš„äººä¸‰å€‹å„ªé»ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "å”±ä¸€é¦–å…’æ­Œï¼ˆä¾‹å¦‚å…©éš»è€è™ï¼‰ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "ç”¨å±è‚¡å¯«å­—ï¼ˆä½ çš„åå­—ï¼‰ã€‚", level: "Easy" },
          { type: "dare", content: "è®“å·¦é‚Šçš„äººå¹«ä½ æ•´ç†é ­é«®ã€‚", level: "Easy" },
          { type: "dare", content: "é›™æ‰‹èˆ‰é«˜ç¶­æŒä¸€åˆ†é˜ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "å’Œå³é‚Šçš„äººåæŒ‡ç·Šæ‰£ 10 ç§’ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "æ¨¡ä»¿åæ¨¡èµ°å°æ­¥ä¸€åœˆã€‚", level: "Easy" },
          { type: "dare", content: "è¬›ä¸€å€‹å†·ç¬‘è©±ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "è·Ÿå¤§å®¶åˆ†äº«ä½ æœ€è¿‘çš„ä¸€å€‹æœå°‹ç´€éŒ„ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "å°è‘—é¡å­ç¨±è®šè‡ªå·± 30 ç§’ã€‚", level: "Easy" },
          { type: "dare", content: "å­¸å¬°å…’å“­ 10 ç§’ã€‚", level: "Easy" },
          { type: "dare", content: "å–ä¸€å¤§æ¯æ°´ã€‚", level: "Easy" },
          { type: "dare", content: "è®“å¤§å®¶æª¢æŸ¥ä½ çš„åŒ…åŒ…ã€‚", level: "Easy" },
          { type: "dare", content: "é–‰è‘—çœ¼ç›ç•«ä¸€éš»è±¬ã€‚", level: "Easy" },
          { type: "dare", content: "æ¨¡ä»¿å¤§çŒ©çŒ©æ¥èƒ¸ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "ç”¨æ…¢å‹•ä½œåšä¸€å€‹å‹•ä½œï¼ˆä¾‹å¦‚å–æ°´ï¼‰ã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "æ¡è‘—éš”å£çš„äººçš„æ‰‹èªªã€Œå¹¸æœƒå¹¸æœƒã€ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "æ‹ä¸€å¼µå¤§å®¶çš„å¤§åˆç…§ã€‚", level: "Easy" },

          // ğŸŸ¡ Level 2: Normal Truth (Normal)
          {
            type: "truth",
            content: "æ›¾ç¶“å‡è£ç”Ÿç—…è«‹å‡å»åšä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°çš„è¡£å“æœ€å·®ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "æ‰‹æ©Ÿè£¡æœ€é†œçš„ä¸€å¼µç…§ç‰‡æ˜¯èª°ï¼Ÿï¼ˆå¿…é ˆå±•ç¤ºï¼‰",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å·çœ‹éèª°çš„æ‰‹æ©Ÿæˆ–æ—¥è¨˜ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "èªªå‡ºä½ åœ¨å ´æœ€æƒ³åæ§½çš„ä¸€å€‹äººã€‚",
            level: "Normal",
          },
          {
            type: "truth",
            content: "åœ¨å ´é€™ç¾¤äººä¸­ï¼Œä½ è¦ºå¾—èª°å°‡ä¾†æœƒæœ€å¯Œæœ‰ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨æ¸¸æ³³æ± å·å°¿å°¿éå—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "ä¸Šä¸€æ¬¡æ”¾å±ä¸å°å¿ƒå´©å‡ºã€Œæ±è¥¿ã€æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "å¦‚æœä½ æ˜¯ç•°æ€§ï¼Œä½ æœƒæƒ³è·Ÿè‡ªå·±äº¤å¾€å—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“æŠŠåˆ¥äººé€çš„ç¦®ç‰©è½‰é€å‡ºå»å—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "è¦ºå¾—åœ¨å ´èª°æœ€å®¹æ˜“è¢«è©é¨™ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "èªªå‡ºä¸€å€‹ä½ ä¸æƒ³è®“çˆ¶æ¯çŸ¥é“çš„ç§˜å¯†ã€‚",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨å…¬å…±å ´åˆåšéæœ€ä¸Ÿè‡‰çš„äº‹ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "è¦ºå¾—å“ªå€‹å¡é€šäººç‰©æœ€æ€§æ„Ÿï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "å¦‚æœè¦åˆªé™¤ä¸€ä½åœ¨å ´å¥½å‹çš„è¯çµ¡æ–¹å¼ï¼Œé¸èª°ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å°è€é—†æˆ–è€å¸«èªªéæœ€å¤§çš„è¬Šï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ´—è¡£æœæœƒæŠŠå…§è¤²è·Ÿè¥ªå­ä¸€èµ·æ´—å—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å·åƒéåˆ¥äººçš„æ±è¥¿æ²’æ‰¿èªå—ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€æœƒè¨˜ä»‡ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ‰æ²’æœ‰æŒ–é¼»å­”åƒä¸‹å»éï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "ç¬¬ä¸€æ¬¡æ¥å»æ˜¯åœ¨å¹¾æ­²ï¼Ÿå°è±¡æ˜¯èª°ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "ç‚ºäº†å¸å¼•ç•°æ€§ï¼Œåšéæœ€è ¢çš„äº‹ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "åœ¨å ´èª°çš„é•·ç›¸è®“ä½ è¦ºå¾—æœ€ã€Œå®‰å…¨ã€ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨å¿ƒè£¡å·å·è©›å’’éèª°ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æœ€è¿‘ä¸€æ¬¡èªªè¬Šæ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ",
            level: "Normal",
          },

          // ğŸŸ¡ Level 2: Normal Dare (Normal)
          {
            type: "dare",
            content: "éš¨æ©Ÿæ‰“çµ¦é€šè¨ŠéŒ„ä¸€å€‹äººå”±ç”Ÿæ—¥å¿«æ¨‚æ­Œã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨å±è‚¡æ’åœ¨å ´æ¯å€‹äººçš„å±è‚¡ä¸€ä¸‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å«è‘—æ°´å“¼ä¸€é¦–æ­Œè®“å¤§å®¶çŒœã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è·³ä¸€æ®µç›®å‰æœ€ç´…çš„æŠ–éŸ³èˆã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è®“å³é‚Šçš„äººæ”ä½ ç™¢ 10 ç§’é˜ï¼Œä¸èƒ½ç¬‘ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨ä½ çš„æ‰‹è‚˜æ‰“å­—ç™¼ä¸€å‰‡å‹•æ…‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è·ªåœ¨æ¤…å­ä¸Šæ¨¡ä»¿å¤ä»£äººè«‹å®‰ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "å¤¾è‘—é¼»å­èªªè©±ä¸€è¼ªã€‚", level: "Normal" },
          {
            type: "dare",
            content: "æŠŠé‹å­è„«ä¸‹ä¾†ï¼Œèä¸€ä¸‹ä¸¦å½¢å®¹å‘³é“ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å»å»šæˆ¿ç‰¹èª¿ä¸€æ¯ã€Œæ€ªå‘³é£²æ–™ã€ä¸¦å–ä¸€å£ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "æ‰“çµ¦åª½åª½èªªï¼šã€Œæˆ‘å¥½åƒå–œæ­¡ä¸ŠåŒæ€§äº†ã€ï¼ˆè¨˜å¾—è§£é‡‹ï¼‰ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è®“åœ¨å ´æ¯å€‹äººå½ˆä½ é¡é ­ä¸€ä¸‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å‡è£é›»è¦–è³¼ç‰©æ¨éŠ·ä½ ç©¿çš„è¥ªå­ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å°è‘—Siriå¤§å–Šã€Œæˆ‘å¥½å¯‚å¯ã€ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "èƒŒè‘—å³é‚Šçš„äººç¹æˆ¿é–“ä¸€åœˆã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å’Œåœ¨å ´ä¸€ä½ç•°æ€§å°è¦– 30 ç§’ï¼Œå…ˆç¬‘çš„äººè¼¸ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "èººåœ¨åœ°ä¸Šæ¨¡ä»¿ä¸€æ¢èŸ²è •å‹•ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨ä¸åŒæ–¹è¨€æˆ–å¤–èªè‡ªæˆ‘ä»‹ç´¹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "åœ¨ç¤¾ç¾¤è»Ÿé«”ç™¼æ–‡ï¼šã€Œå…¶å¯¦æˆ‘æš—æˆ€éš”å£è€ç‹å¾ˆä¹…äº†ã€ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "è¡¨æ¼”ä¾¿ç§˜æ™‚çš„è¡¨æƒ…ã€‚", level: "Normal" },
          {
            type: "dare",
            content: "åªèƒ½ç”¨ã€Œæ±ªã€å›ç­”å¤§å®¶çš„å•é¡Œä¸‰åˆ†é˜ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç•¶çœ¾æŒ–é¼»å­”ï¼ˆå‡è£ä¹Ÿè¦å¾ˆåƒï¼‰ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è®“ä¸€ä½ç•°æ€§å¹«ä½ ç•«å£ç´…æˆ–ç•«è‡‰ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "æ¨¡ä»¿é€™å±€è¼¸æœ€æ…˜çš„äººèªªè©±æ–¹å¼ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "é¸ä¸€é¦–æ­Œçš„å‰¯æ­Œï¼Œç”¨ã€Œæ‚²å‚·ã€çš„èªæ°£å”¸å‡ºä¾†ã€‚",
            level: "Normal",
          },

          // ğŸ”´ Level 3: Hard Truth (Hard)
          {
            type: "truth",
            content: "é€™è¼©å­æœ€å¾Œæ‚”çš„ä¸€ä»¶äº‹æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "å¦‚æœç”Ÿå‘½åªå‰©24å°æ™‚ï¼Œæƒ³å°èª°èªªä»€éº¼ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æˆé•·éç¨‹ä¸­ï¼Œå“ªä»¶äº‹å°ä½ çš„åƒ¹å€¼è§€å½±éŸ¿æœ€å¤§ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "ä½ æœ€å®³æ€•å¤±å»ä»€éº¼ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æ›¾ç¶“å°æœ‹å‹çš„å¦ä¸€åŠå‹•éå¿ƒå—ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€é›£ç›¸è™•ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "å¦‚æœå¿…é ˆè·Ÿåœ¨å ´ä¸€å€‹äººçµ•äº¤ï¼Œä½ æœƒé¸èª°ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä¸Šä¸€æ¬¡ç™¼è‡ªå…§å¿ƒå¤§å“­æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä½ è¦ºå¾—è‡ªå·±æœ€å¤§çš„ç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æœ‰æ²’æœ‰å“ªå€‹å¤¢æƒ³æ˜¯ä½ å·²ç¶“æ”¾æ£„çš„ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä»€éº¼æ¨£çš„èˆ‰å‹•æœƒè®“ä½ ç¬é–“å°ä¸€å€‹äººå¤±æœ›ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "ä½ è¦ºå¾—éŒ¢èƒ½è²·åˆ°å¹¸ç¦å—ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "è·Ÿçˆ¶æ¯çš„é—œä¿‚å¦‚ä½•ï¼Ÿæœ‰ä»€éº¼æƒ³è§£é–‹çš„å¿ƒçµï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä½ çœŸå¿ƒå–œæ­¡ç¾åœ¨çš„å·¥ä½œ/ç”Ÿæ´»å—ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“è¢«æŠ“åŒ…åŠˆè…¿æˆ–æŠ“åŒ…åˆ¥äººåŠˆè…¿å—ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "åœ¨å ´èª°è®“ä½ è¦ºå¾—æœ€èƒ½ä¾é ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æ›¾ç¶“è·Ÿå¥½å‹çš„å‰ä»»äº¤å¾€éå—ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æœ€è¨å­åœ¨å ´èª°çš„å“ªä¸€å€‹ç¿’æ…£ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "ä½ è¦ºå¾—æ„›æƒ…çš„å®šç¾©æ˜¯ä»€éº¼ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "å¦‚æœåœ¨å ´ä¸€å®šè¦é¸ä¸€å€‹äººæ¥å»ï¼Œä½ æœƒé¸èª°ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“æœ‰éæƒ³è¦ã€Œæ¶ˆå¤±ã€çš„å¿µé ­å—ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "å°ã€Œé–‹æ”¾å¼é—œä¿‚ã€æœ‰ä»€éº¼çœ‹æ³•ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "èªªå‡ºä¸€å€‹ä½ å°æ€§çš„åœ°é›·ã€‚", level: "Hard" },
          {
            type: "truth",
            content: "åœ¨å ´çš„äººç•¶ä¸­ï¼Œä½ æœ€ç¾¨æ…•èª°çš„ä»€éº¼ç‰¹è³ªï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ç¾åœ¨çš„ä½ ï¼Œæƒ³å°10å¹´å‰çš„è‡ªå·±èªªä»€éº¼ï¼Ÿ",
            level: "Hard",
          },

          // ğŸ”´ Level 3: Hard Dare (Hard)
          {
            type: "dare",
            content: "è®“å¤§å®¶ç€è¦½ä½ çš„ç€è¦½å™¨æœå°‹ç´€éŒ„ï¼ˆæœ€è¿‘3æ¢ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å»å†°ç®±æ‹¿ä¸€é¡†å†°å¡Šï¼Œæ”¾åœ¨è¡£æœè£¡ç›´åˆ°èåŒ–ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "åœ¨ä¸€ä½ç•°æ€§èº«ä¸Šåšä¼åœ°æŒºèº« 5 ä¸‹ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ æ‰‹æ©Ÿç›¸ç°¿è£¡æœ€æ–°çš„é‚£å¼µæˆªåœ–ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è·Ÿå¤§å®¶åˆ†äº«ä½ å…§è¤²çš„é¡è‰²å’Œæ¬¾å¼ï¼ˆå¿…é ˆæª¢æŸ¥ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å…¬ä¸»æŠ±ï¼ˆæˆ–è¢«å…¬ä¸»æŠ±ï¼‰ä¸€ä½ç•°æ€§åšæ·±è¹² 3 ä¸‹ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ“æŠ±åœ¨ä½ å³é‚Šçš„äºº 20 ç§’ï¼Œä»€éº¼è©±éƒ½ä¸èƒ½èªªã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ‰“é›»è©±çµ¦ä¸€ä½å¥½ä¹…æ²’è¯çµ¡çš„æœ‹å‹ï¼Œèªªæƒ³ä»–äº†ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "é¸ä¸€å€‹äººï¼Œå¹«ä»–æŒ‰æ‘© 3 åˆ†é˜ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "åœ¨ç¤¾ç¾¤åª’é«”ä¸Šç™¼ä¸€ç¯‡æ„Ÿè¬æ–‡ï¼Œæ„Ÿè¬åœ¨å ´çš„ä¸€å€‹äººã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "èˆ‡å·¦é‚Šçš„äººå°è¦– 1 åˆ†é˜ï¼Œä¸å‡†ç¬‘ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ‰¿è«¾å¹«åœ¨å ´çš„ä¸€å€‹äººåšä¸€ä»¶å°äº‹ï¼ˆè·‘è…¿ç­‰ï¼‰ã€‚",
            level: "Hard",
          },
          { type: "dare", content: "è¬›ä¸€å€‹è‡ªå·±å¾ˆè„†å¼±çš„æ•…äº‹ã€‚", level: "Hard" },
          {
            type: "dare",
            content: "å°è‘—é¡å­è£¡çš„è‡ªå·±èªªä¸‰å¥é¼“å‹µçš„è©±ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "é¸ä¸€å€‹äººï¼Œå‘Šè¨´ä»–ä½ ç¬¬ä¸€çœ¼çœ‹ä»–çš„å°è±¡èˆ‡ç¾åœ¨çš„åå·®ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "é–‰ä¸Šçœ¼ï¼Œè®“å¤§å®¶éš¨æ©Ÿé¸ä¸€å€‹äººè¦ªä½ çš„è‡‰é °ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è„«æ‰ä¸€ä»¶èº«ä¸Šçš„è¡£ç‰©ï¼ˆé£¾å“ä¸ç®—ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å’Œä¸€ä½ç•°æ€§äº’æ›ä¸Šè¡£ï¼ˆæˆ–å¤–å¥—ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è®“åœ¨å ´çš„ä¸€ä½ç•°æ€§èä½ çš„é ¸çª©å‘³é“ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "ç”¨å˜´å·´å’¬èµ·æ¡Œä¸Šçš„ä¸€æ”¯ç­†ï¼Œå‚³çµ¦ä¸‹ä¸€ä½ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "ç”¨ä¼åœ°æŒºèº«å§¿å‹¢ï¼Œæ’è‘—ç›´åˆ°ä¸‹ä¸€è¼ªã€‚",
            level: "Hard",
          },
          { type: "dare", content: "æ¨¡ä»¿Aç‰‡é–‹é ­çš„ç¶“å…¸å°è©ã€‚", level: "Hard" },
          {
            type: "dare",
            content: "è®“åœ¨å ´ä¸€ä½ç•°æ€§å¹«ä½ è„«è¥ªå­ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "é¸ä¸€ä½ç•°æ€§ï¼Œå…©äººåæŒ‡ç·Šæ‰£ç›´åˆ°ä¸‹ä¸€è¼ªã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "èªçœŸåœ°ç¨±è®šåœ¨å ´æ¯å€‹äººä¸€å€‹å„ªé»ã€‚",
            level: "Hard",
          },

          // ğŸ” Level 4: Adult Truth (Adult)
          {
            type: "truth",
            content: "åœ¨å ´çš„ç•°æ€§ä¸­ï¼Œèª°æœ€æ¥è¿‘ä½ çš„æ€§å¹»æƒ³å°è±¡ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "ç¬¬ä¸€æ¬¡ç™¼ç”Ÿæ€§è¡Œç‚ºæ˜¯åœ¨å¹¾æ­²ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“æœ‰éä¸€å¤œæƒ…å—ï¼Ÿæˆ–è€…æƒ³å˜—è©¦å—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "èƒ½å¤ æ¥å—çš„å¹´é½¡å·®æœ€å¤§æ˜¯å¤šå°‘ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "å–œæ­¡é–‹ç‡ˆé‚„æ˜¯é—œç‡ˆè¾¦äº‹ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "è¦ºå¾—è‡ªå·±çš„åºŠä¸ŠåŠŸå¤«å¹¾åˆ†ï¼ˆæ»¿åˆ†10åˆ†ï¼‰ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨æˆ¶å¤–æˆ–ç‰¹æ®Šåœ°é»ã€Œè»Šéœ‡/é‡æˆ°ã€éå—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "å°åœ¨å ´çš„æŸå€‹äººæœ‰ééåˆ†ä¹‹æƒ³å—ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "èªªå‡ºä¸€å€‹ä½ çš„æ€§ç™–å¥½ã€‚", level: "Adult" },
          {
            type: "truth",
            content: "çœ‹ç•°æ€§ç¬¬ä¸€çœ¼æœƒçœ‹å“ªå€‹éƒ¨ä½ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åŒæ™‚è·Ÿå…©å€‹äººä»¥ä¸Šææ›–æ˜§å—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "å‰ä»»æ•™éä½ æœ€é‡è¦çš„ä¸€ä»¶äº‹æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ”¶åˆ°éæœ€å¥‡æ€ªçš„é¨·æ“¾è¨Šæ¯æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "ç›®å‰ç‚ºæ­¢ï¼Œæ“æœ‰éå¹¾å€‹æ€§ä¼´ä¾¶ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "ç¡è¦ºæ™‚ç¿’æ…£ç©¿ä»€éº¼ï¼ˆæˆ–ä¸ç©¿ï¼‰ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æœ€çŸ­çš„ä¸€æ¬¡æˆ€æ„›ï¼ˆæˆ–åºŠäº‹ï¼‰ç¶­æŒå¤šä¹…ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "è¦ºå¾—åœ¨å ´èª°çœ‹èµ·ä¾†æœ€ã€Œæ€§å†·æ„Ÿã€ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å¹»æƒ³éè·ŸåŒæ€§ç™¼ç”Ÿé—œä¿‚å—ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "å–œæ­¡ä¸»å‹•é‚„æ˜¯è¢«å‹•ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "æ›¾ç¶“ç”¨éäº¤å‹è»Ÿé«”ç´„ç ²å—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "èº«é«”æœ€æ•æ„Ÿçš„éƒ¨ä½åœ¨å“ªè£¡ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "ä¸Šä¸€æ¬¡è‡ªæ…°æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "è¦ºå¾—æ€§é‡è¦é‚„æ˜¯æ„›é‡è¦ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "æ›¾ç¶“æ‹éæˆ–æ”¶éç§å¯†ç…§å—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "åœ¨å ´èª°çš„èº«ææœ€è®“ä½ æµå£æ°´ï¼Ÿ",
            level: "Adult",
          },

          // ğŸ” Level 4: Adult Dare (Adult)
          {
            type: "dare",
            content: "é¸ä¸€ä½ç•°æ€§ï¼Œç”¨å˜´å°å˜´å‚³éä¸€å¼µè¡›ç”Ÿç´™ï¼ˆæˆ–å†°å¡Šï¼‰ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "åœ¨åœ¨å ´ç•°æ€§ä¸­é¸ä¸€ä½ï¼Œåœ¨ä»–è€³é‚Šå¹æ°£ä¸¦èªªæ‚„æ‚„è©±ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“ä¸€ä½ç•°æ€§ååœ¨ä½ å¤§è…¿ä¸Š 1 åˆ†é˜ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "å°è‘—ä¸€ä½ç•°æ€§åšå‡ºæŒ‘é€—çš„åƒé¦™è•‰ï¼ˆæˆ–æ‰‹æŒ‡ï¼‰å‹•ä½œã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“å³é‚Šçš„äººåœ¨ä½ è„–å­ä¸Šç¨®è‰è“ï¼ˆæˆ–å‡è£ç”¨åŠ›å¸ä¸€ä¸‹ï¼‰ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "ç™¼å‡ºä¸‰ç¨®ä¸åŒé«˜æ½®çš„è²éŸ³ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "é¸ä¸€ä½ç•°æ€§ï¼Œå£å’šä»–ä¸¦æ·±æƒ…å°è¦– 10 ç§’ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“åœ¨å ´çš„ä¸€ä½ç•°æ€§æŠŠæ‰‹ä¼¸é€²ä½ è¡£æœè£¡æ‘¸ä½ çš„èƒŒã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "é¸ä¸€å€‹äººï¼Œè¦ªå»ä»–çš„è„–å­æˆ–é–éª¨ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "ç”¨èˆŒé ­èˆ”æ‰å·¦é‚Šäººæ‰‹èƒŒä¸Šçš„ä¸€æ»´å¥¶æ²¹/é…’ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "ç”¨å˜´å·´è§£é–‹ä¸€ä½ç•°æ€§è¡£æœçš„ä¸€é¡†æ‰£å­ï¼ˆæˆ–æ‹‰éŠï¼‰ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è·³ä¸€æ®µæ€§æ„Ÿçš„è²¼èº«èˆï¼ˆå°è‘—ç©ºæ°£æˆ–æ¤…å­ï¼‰ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "å°è‘—ä¸€ä½ç•°æ€§è·³æ‰­è‡€èˆã€‚", level: "Adult" },
          {
            type: "dare",
            content: "å’¬ä½ä¸€ä½ç•°æ€§çš„è€³æœµï¼ˆè¼•å’¬ï¼‰ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“ä¸€ä½ç•°æ€§æ‘¸ä½ çš„è…¹è‚Œï¼ˆæˆ–è‚šå­è‚‰ï¼‰ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "ç”¨é­…æƒ‘çš„è²éŸ³å”¸å‡ºèœå–®æˆ–èªªæ˜æ›¸ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "èººåœ¨ä¸€ä½ç•°æ€§è…¿ä¸Š 1 åˆ†é˜ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“ä¸€ä½ç•°æ€§å¹«ä½ æŒ‰æ‘©è‚©è†€ 30 ç§’ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "ç”¨å˜´å·´å»å«ä½ä¸€ä½ç•°æ€§çš„æ‰‹æŒ‡ 3 ç§’ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "æŠŠå³æ‰‹æ”¾åœ¨å·¦é‚Šäººçš„å¿ƒè‡Ÿä½ç½® 10 ç§’ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "é¸ä¸€å€‹äººï¼Œæ·±æƒ…åœ°æ¡è‘—ä»–çš„æ‰‹èªªï¼šã€Œä½ ç‚ºä»€éº¼è¦æœ‰è…³æ°£ï¼Ÿã€",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“åœ¨å ´ç•°æ€§æŒ‘é¸ä¸€å€‹éƒ¨ä½è¦ªä½ ä¸€ä¸‹ï¼ˆè‡‰/æ‰‹/é¡é ­ï¼‰ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "æ¨¡ä»¿ä¸€ç¨®æ€§æ„Ÿçš„å§¿å‹¢æ‹ç…§ã€‚", level: "Adult" },
          { type: "dare", content: "ç•¶çœ¾æŠŠçš®å¸¶è§£é–‹å†æ‰£å›å»ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "é–‰çœ¼çŒœæ¸¬ä¸€ä½ç•°æ€§èº«é«”æŸå€‹éƒ¨ä½ï¼ˆç”¨æ‘¸çš„ï¼Œåƒ…é™æ‰‹/è‡‰/è‚©ï¼‰ã€‚",
            level: "Adult",
          },
        ],
        state: {
          players: ["ç©å®¶A", "ç©å®¶B", "ç©å®¶C"],
          questions: [],
          history: [],
          stats: {}, // æ–°å¢ï¼šçµ±è¨ˆæ•¸æ“š
          settings: {
            speed: 30,
            duration: 5000,
            difficultyFilter: "Any",
            segmentCounts: { truth: 10, dare: 10, pass: 2 },
          },
        },
        init() {
          const saved = localStorage.getItem(this.key);
          if (saved) {
            const parsed = JSON.parse(saved);
            this.state = { ...this.state, ...parsed };
            // é˜²å‘†ï¼šå¦‚æœèˆŠè³‡æ–™æ²’æœ‰ statsï¼Œå‰‡åˆå§‹åŒ–
            if (!this.state.stats) this.state.stats = {};
            if (!this.state.settings.segmentCounts) {
              this.state.settings.segmentCounts = {
                truth: 10,
                dare: 10,
                pass: 2,
              };
            }
            if (this.state.questions.length === 0)
              this.state.questions = [...this.defaultDB];
          } else {
            this.state.questions = [...this.defaultDB];
          }
        },
        save() {
          localStorage.setItem(this.key, JSON.stringify(this.state));
        },
        addPlayer(name) {
          if (name && !this.state.players.includes(name)) {
            this.state.players.push(name);
            this.save();
            return true;
          }
          return false;
        },
        removePlayer(index) {
          this.state.players.splice(index, 1);
          this.save();
        },
        addQuestion(q) {
          this.state.questions.push(q);
          this.save();
        },
        removeQuestion(index) {
          this.state.questions.splice(index, 1);
          this.save();
        },
        clearQuestions() {
          this.state.questions = [];
          this.save();
        },
        addHistory(item) {
          this.state.history.unshift(item);
          if (this.state.history.length > 50) this.state.history.pop();
          this.save();
        },
        clearHistory() {
          this.state.history = [];
          this.save();
        },
        // æ–°å¢ï¼šå¢åŠ ç©å®¶è¢«é¸ä¸­æ¬¡æ•¸
        incrementStat(name) {
          if (!this.state.stats) this.state.stats = {};
          this.state.stats[name] = (this.state.stats[name] || 0) + 1;
          this.save();
        },
        // æ–°å¢ï¼šé‡ç½®çµ±è¨ˆ
        resetStats() {
          this.state.stats = {};
          this.save();
        },
        // æ–°å¢ï¼šåŒ¯å‡ºè³‡æ–™
        exportData() {
          const dataStr = JSON.stringify(this.state, null, 2);
          const blob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          const date = new Date();
          const timestamp = `${date.getFullYear()}${String(
            date.getMonth() + 1
          ).padStart(2, "0")}${String(date.getDate()).padStart(2, "0")}`;
          a.href = url;
          a.download = `luxury_tod_backup_${timestamp}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        },
        // æ–°å¢ï¼šåŒ¯å…¥è³‡æ–™
        importData(jsonStr) {
          try {
            const data = JSON.parse(jsonStr);
            // ç°¡æ˜“é©—è­‰
            if (data.players && data.questions && data.settings) {
              this.state = data;
              this.save();
              return true;
            } else {
              return false;
            }
          } catch (e) {
            console.error(e);
            return false;
          }
        },
        aiGenerate() {
          const existing = new Set(this.state.questions.map((q) => q.content));
          const candidates = this.defaultDB.filter(
            (q) => !existing.has(q.content)
          );
          if (candidates.length > 0) {
            this.addQuestion(
              candidates[Math.floor(Math.random() * candidates.length)]
            );
          } else {
            const types = ["truth", "dare"];
            const newQ = {
              type: types[Math.floor(Math.random() * 2)],
              content: `(AIç”Ÿæˆ) è«‹è©³ç´°æè¿°ä½ å°${Math.floor(
                Math.random() * 100
              )}è™Ÿè©±é¡Œçš„çœ‹æ³•ã€‚`,
              level: "Normal",
            };
            this.addQuestion(newQ);
          }
          return true;
        },
        getQuestionByType(type) {
          let filtered = this.state.questions.filter((q) => q.type === type);
          const filterLevel = this.state.settings.difficultyFilter;

          let levelFiltered = filtered;

          if (filterLevel === "Adult") {
            levelFiltered = filtered.filter((q) => q.level === "Adult");
          } else if (filterLevel === "Hard") {
            levelFiltered = filtered.filter(
              (q) => q.level === "Hard" || q.level === "Adult"
            );
          } else if (filterLevel === "Normal") {
            levelFiltered = filtered.filter((q) => q.level !== "Easy");
          }

          if (levelFiltered.length === 0) levelFiltered = filtered;
          if (levelFiltered.length === 0) return null;

          return levelFiltered[
            Math.floor(Math.random() * levelFiltered.length)
          ];
        },
        getRandomPlayer() {
          if (this.state.players.length === 0) return "åŒ¿åç©å®¶";
          return this.state.players[
            Math.floor(Math.random() * this.state.players.length)
          ];
        },
      };

      /* ==================== Wheel Module ==================== */
      const WheelModule = {
        canvas: null,
        ctx: null,
        segments: [],
        angleCurrent: 0,
        angleDelta: 0,
        isSpinning: false,
        spinTime: 0,
        spinTimeTotal: 0,
        requestFrameId: null,

        init() {
          this.canvas = document.getElementById("wheelCanvas");
          this.ctx = this.canvas.getContext("2d");
          this.generateSegments();
          this.draw();
        },

        generateSegments() {
          const { truth, dare, pass } = DataModule.state.settings.segmentCounts;

          // å»ºç«‹åŸºç¤é™£åˆ— (Pools)
          const tPool = Array(truth).fill({
            text: "çœŸå¿ƒè©±",
            type: "truth",
            color: "#1565C0",
            txtColor: "#FFFFFF",
          });
          const dPool = Array(dare).fill({
            text: "å¤§å†’éšª",
            type: "dare",
            color: "#C62828",
            txtColor: "#FFFFFF",
          });
          const pPool = Array(pass).fill({
            text: "ä¸‹é¢ä¸€ä½",
            type: "pass",
            color: "#D4AF37",
            txtColor: "#000000",
          });

          let combined = [];
          // æ‰¾å‡ºæœ€å¤§çš„æ•¸é‡ï¼Œç”¨æ–¼è¿´åœˆ
          const max = Math.max(truth, dare, pass);

          // äº¤å‰åˆ†ä½ˆ (Round Robin / Interleave)
          for (let i = 0; i < max; i++) {
            if (tPool[i]) combined.push(tPool[i]);
            if (dPool[i]) combined.push(dPool[i]);
            if (pPool[i]) combined.push(pPool[i]);
          }

          // é˜²å‘†
          if (combined.length === 0)
            combined.push({
              text: "è«‹è¨­å®š",
              type: "pass",
              color: "#888",
              txtColor: "#FFF",
            });

          this.segments = combined;
        },

        draw() {
          const ctx = this.ctx;
          const w = this.canvas.width;
          const h = this.canvas.height;
          const cx = w / 2;
          const cy = h / 2;
          const radius = w / 2 - 10;
          const count = this.segments.length;
          const arc = (Math.PI * 2) / count;

          ctx.clearRect(0, 0, w, h);
          for (let i = 0; i < count; i++) {
            const angle = this.angleCurrent + i * arc;
            const seg = this.segments[i];

            ctx.fillStyle = seg.color;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, angle, angle + arc, false);
            ctx.lineTo(cx, cy);
            ctx.fill();

            ctx.save();
            ctx.translate(
              cx + Math.cos(angle + arc / 2) * (radius - 50),
              cy + Math.sin(angle + arc / 2) * (radius - 50)
            );
            ctx.rotate(angle + arc / 2 + Math.PI / 2);
            ctx.fillStyle = seg.txtColor;
            ctx.font = 'bold 14px "Noto Sans TC"';
            const text = seg.text;
            ctx.fillText(text, -ctx.measureText(text).width / 2, 0);
            ctx.restore();
          }
        },
        spin() {
          if (this.isSpinning) return;
          this.isSpinning = true;

          // --- é‡ç½®èƒŒæ™¯ç‚ºé è¨­é»‘è‰²åŠé€æ˜ ---
          document.querySelector(".game-info").style.background =
            "rgba(0, 0, 0, 0.6)";

          const speedMult = DataModule.state.settings.speed / 10;
          this.spinTime = 0;
          this.spinTimeTotal =
            DataModule.state.settings.duration * (0.8 + Math.random() * 0.4);
          this.angleDelta = (Math.random() * 10 + 20) * speedMult;
          AudioModule.play("spin");
          this.rotate();
        },
        rotate() {
          this.spinTime += 30;
          if (this.spinTime >= this.spinTimeTotal) {
            this.stop();
            return;
          }
          const spinAngle =
            this.angleDelta -
            this.angleDelta * (this.spinTime / this.spinTimeTotal);
          this.angleCurrent += (spinAngle * Math.PI) / 180;
          this.draw();
          this.requestFrameId = requestAnimationFrame(this.rotate.bind(this));
        },
        stop() {
          this.isSpinning = false;
          cancelAnimationFrame(this.requestFrameId);
          AudioModule.stop("spin");
          AudioModule.play("win");

          // è§¸ç™¼æ…¶ç¥ç‰¹æ•ˆ
          EffectModule.triggerConfetti();

          const count = this.segments.length;
          const arc = (Math.PI * 2) / count;
          const rotation = this.angleCurrent % (Math.PI * 2);
          let index = Math.floor((Math.PI * 1.5 - rotation) / arc);
          index = ((index % count) + count) % count;

          const resultSegment = this.segments[index];
          UIModule.showResult(resultSegment.type);
        },
      };

      /* ==================== Effect Module ==================== */
      const EffectModule = {
        triggerConfetti() {
          // é‡‘è‰²ç³»é…è‰²
          const goldColors = [
            "#d4af37",
            "#f4df87",
            "#aa8c2c",
            "#FFFF00",
            "#ffffff",
          ];

          // ç¬¬ä¸€æ¬¡å™´ç™¼ (å·¦ä¸‹)
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6, x: 0.2 },
            colors: goldColors,
          });

          // ç¬¬äºŒæ¬¡å™´ç™¼ (å³ä¸‹)
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6, x: 0.8 },
            colors: goldColors,
          });

          // éš¨æ©Ÿç‘è½çš„é‡‘ç²‰æ•ˆæœ (æŒçºŒä¸€å°æ®µæ™‚é–“)
          const duration = 2000;
          const end = Date.now() + duration;

          (function frame() {
            confetti({
              particleCount: 3,
              angle: 60,
              spread: 55,
              origin: { x: 0 },
              colors: goldColors,
            });
            confetti({
              particleCount: 3,
              angle: 120,
              spread: 55,
              origin: { x: 1 },
              colors: goldColors,
            });

            if (Date.now() < end) {
              requestAnimationFrame(frame);
            }
          })();
        },
      };

      /* ==================== Audio Module ==================== */
      const AudioModule = {
        bgm: null,
        spin: null,
        win: null,
        isMuted: false,
        init() {
          this.bgm = document.getElementById("bgm");
          this.spin = document.getElementById("sfx-spin");
          this.win = document.getElementById("sfx-win");
          this.bgm.volume = 0.3;
          document
            .getElementById("musicToggle")
            .addEventListener("click", () => {
              this.toggleMusic();
            });
          document.body.addEventListener(
            "click",
            () => {
              if (!this.isMuted && this.bgm.paused)
                this.bgm.play().catch((e) => {});
            },
            { once: true }
          );
        },
        play(type) {
          if (this.isMuted) return;
          if (type === "spin") {
            this.spin.currentTime = 0;
            this.spin.play().catch((e) => {});
          } else if (type === "win") {
            this.win.currentTime = 0;
            this.win.play().catch((e) => {});
          }
        },
        stop(type) {
          if (type === "spin") {
            this.spin.pause();
            this.spin.currentTime = 0;
          }
        },
        toggleMusic() {
          this.isMuted = !this.isMuted;
          const btn = document.getElementById("musicToggle");
          if (this.isMuted) {
            this.bgm.pause();
            btn.innerHTML = '<i class="material-icons">music_off</i>';
          } else {
            this.bgm.play().catch((e) => {});
            btn.innerHTML = '<i class="material-icons">music_note</i>';
          }
        },
      };

      /* ==================== Timer Module ==================== */
      const TimerModule = {
        mode: "countdown", // 'countdown' or 'stopwatch'
        time: 60, // current seconds
        initialTime: 60, // for reset in countdown
        interval: null,
        isRunning: false,

        init() {
          this.updateDisplay();
        },

        switchMode(newMode) {
          this.reset();
          this.mode = newMode;
          const presets = document.getElementById("timer-presets-container");
          if (this.mode === "stopwatch") {
            this.time = 0;
            this.initialTime = 0;
            presets.style.display = "none";
          } else {
            this.time = 60;
            this.initialTime = 60;
            presets.style.display = "flex";
          }
          this.updateDisplay();
        },

        toggle() {
          if (this.isRunning) this.pause();
          else this.start();
        },

        start() {
          if (this.isRunning) return;
          this.isRunning = true;
          document.getElementById("timer-icon-play").innerText = "pause";
          document
            .getElementById("timer-display")
            .classList.remove("timer-blink");

          this.interval = setInterval(() => {
            if (this.mode === "countdown") {
              if (this.time > 0) {
                this.time--;
              } else {
                this.finish();
              }
            } else {
              this.time++;
            }
            this.updateDisplay();
          }, 1000);
        },

        pause() {
          this.isRunning = false;
          clearInterval(this.interval);
          document.getElementById("timer-icon-play").innerText = "play_arrow";
        },

        reset() {
          this.pause();
          this.time = this.initialTime;
          document
            .getElementById("timer-display")
            .classList.remove("timer-blink");
          this.updateDisplay();
        },

        finish() {
          this.pause();
          document.getElementById("timer-display").classList.add("timer-blink");
          AudioModule.play("win"); // Play sound when time is up
        },

        addTime(seconds) {
          if (this.mode === "countdown") {
            this.time += seconds;
            this.initialTime = this.time; // Update reset point
            this.updateDisplay();
          }
        },

        updateDisplay() {
          const m = Math.floor(this.time / 60);
          const s = this.time % 60;
          const str = `${m.toString().padStart(2, "0")}:${s
            .toString()
            .padStart(2, "0")}`;
          document.getElementById("timer-display").innerText = str;
        },
      };

      /* ==================== UI Module ==================== */
      const UIModule = {
        init() {
          this.renderPlayerList();
          this.renderQuestionList();
          this.renderHistory();
          this.bindEvents();
          this.bindKeyboardEvents(); // åˆå§‹åŒ–éµç›¤äº‹ä»¶
          this.renderSettingsValues();
          this.updateSpinButton();
        },

        switchPanel(panelId, btnElement) {
          document
            .querySelectorAll(".panel")
            .forEach((p) => p.classList.remove("active"));
          document.getElementById(panelId).classList.add("active");

          document
            .querySelectorAll(".nav-btn")
            .forEach((b) => b.classList.remove("active"));

          if (btnElement) {
            btnElement.classList.add("active");
          } else {
            // è‡ªå‹•å°‹æ‰¾ä¸¦é»äº®å°æ‡‰çš„å°èˆªæŒ‰éˆ• (çµ¦ Esc éµç”¨)
            const btns = document.querySelectorAll(".nav-btn");
            for (let btn of btns) {
              if (
                btn.getAttribute("onclick") &&
                btn.getAttribute("onclick").includes(panelId)
              ) {
                btn.classList.add("active");
                break;
              }
            }
          }

          if (panelId === "panel-leaderboard") {
            this.renderLeaderboard();
          }
        },
        toggleSidebar() {
          document.body.classList.toggle("sidebar-collapsed");
        },

        updateSpinButton() {
          const btn = document.getElementById("spinBtn");
          const totalSegments =
            DataModule.state.settings.segmentCounts.truth +
            DataModule.state.settings.segmentCounts.dare +
            DataModule.state.settings.segmentCounts.pass;

          if (DataModule.state.players.length === 0 || totalSegments === 0) {
            btn.disabled = true;
            btn.innerText = "è«‹å…ˆæ–°å¢ç©å®¶æˆ–è¨­å®šè½‰ç›¤";
          } else {
            btn.disabled = false;
            btn.innerText = "é–‹å§‹æ—‹è½‰";
          }
        },

        renderPlayerList() {
          const list = document.getElementById("player-list");
          const count = document.getElementById("player-count");
          list.innerHTML = "";
          DataModule.state.players.forEach((p, index) => {
            list.innerHTML += `
                        <div class="list-item">
                            <span><i class="material-icons" style="font-size:16px; vertical-align:middle">person</i> ${p}</span>
                            <button class="delete-btn" onclick="UIModule.handleRemovePlayer(${index})"><i class="material-icons">delete</i></button>
                        </div>`;
          });
          count.innerText = DataModule.state.players.length;
          this.updateSpinButton();
        },
        handleAddPlayer() {
          const input = document.getElementById("new-player-input");
          if (DataModule.addPlayer(input.value.trim())) {
            input.value = "";
            this.renderPlayerList();
          } else {
            alert("è«‹è¼¸å…¥æœ‰æ•ˆä¸”ä¸é‡è¤‡çš„ç©å®¶åç¨±");
          }
        },
        handleRemovePlayer(index) {
          if (confirm("ç¢ºå®šåˆªé™¤æ­¤ç©å®¶ï¼Ÿ")) {
            DataModule.removePlayer(index);
            this.renderPlayerList();
          }
        },

        renderQuestionList(filterType = "all") {
          const list = document.getElementById("question-list");
          list.innerHTML = "";
          DataModule.state.questions.forEach((q, index) => {
            if (filterType !== "all" && q.type !== filterType) return;
            const typeClass = q.type === "truth" ? "truth" : "dare";
            const typeText = q.type === "truth" ? "çœŸå¿ƒè©±" : "å¤§å†’éšª";

            let levelClass = "";
            if (q.level === "Adult") levelClass = "level-adult";

            let levelText = q.level;
            if (q.level === "Adult") levelText = "å¤§äººå°ˆå±¬";
            if (q.level === "Easy") levelText = "ç°¡å–®";
            if (q.level === "Normal") levelText = "æ™®é€š";
            if (q.level === "Hard") levelText = "å›°é›£";

            list.innerHTML += `
                        <div class="list-item ${typeClass}">
                            <div>
                                <span class="tag">${typeText}</span>
                                <span class="tag ${levelClass}" style="background:#555">${levelText}</span>
                                <span>${q.content}</span>
                            </div>
                            <button class="delete-btn" onclick="UIModule.handleRemoveQuestion(${index})"><i class="material-icons">delete</i></button>
                        </div>`;
          });
          this.updateSpinButton();
        },
        handleAddQuestion() {
          const input = document.getElementById("new-q-input");
          const type = document.getElementById("q-type").value;
          const diff = document.getElementById("q-difficulty").value;
          if (input.value.trim()) {
            DataModule.addQuestion({
              type: type,
              content: input.value.trim(),
              level: diff,
            });
            input.value = "";
            this.renderQuestionList();
          }
        },
        handleRemoveQuestion(index) {
          DataModule.removeQuestion(index);
          this.renderQuestionList();
        },
        handleClearQuestions() {
          if (confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰å•é¡Œå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼")) {
            DataModule.clearQuestions();
            this.renderQuestionList();
          }
        },
        handleAiGenerate() {
          DataModule.aiGenerate();
          this.renderQuestionList();
          const btn = document.getElementById("ai-generate-btn");
          btn.innerHTML = '<i class="material-icons">check</i> å·²ç”Ÿæˆ';
          setTimeout(
            () =>
              (btn.innerHTML =
                '<i class="material-icons">auto_awesome</i> AI ç”¢ç”Ÿ'),
            1000
          );
        },

        renderLeaderboard() {
          const list = document.getElementById("leaderboard-list");
          list.innerHTML = "";

          const currentStats = DataModule.state.players.map((p) => {
            return {
              name: p,
              count: (DataModule.state.stats && DataModule.state.stats[p]) || 0,
            };
          });

          currentStats.sort((a, b) => b.count - a.count);

          if (currentStats.length === 0) {
            list.innerHTML =
              '<div style="text-align:center; color:#666; padding:20px;">å°šç„¡ç©å®¶</div>';
            return;
          }

          currentStats.forEach((player, index) => {
            let rankClass = "";
            let icon = "";
            if (index === 0) {
              rankClass = "rank-1";
              icon = '<i class="material-icons rank-icon">emoji_events</i>';
            } else if (index === 1) {
              rankClass = "rank-2";
              icon = '<i class="material-icons rank-icon">military_tech</i>';
            } else if (index === 2) {
              rankClass = "rank-3";
              icon =
                '<i class="material-icons rank-icon">workspace_premium</i>';
            } else {
              icon = `<span style="display:inline-block; width:24px; text-align:center; font-weight:bold; color:#666; font-size:1.1rem">${
                index + 1
              }</span>`;
            }

            list.innerHTML += `
                  <div class="list-item ${rankClass}" style="padding: 15px;">
                      <div style="display:flex; align-items:center;">
                          ${icon}
                          <span style="margin-left:12px; font-size:1.1rem">${player.name}</span>
                      </div>
                      <div>
                          è¢«é¸ä¸­ <span class="rank-count">${player.count}</span> æ¬¡
                      </div>
                  </div>`;
          });
        },
        handleResetStats() {
          if (confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰æ’è¡Œçµ±è¨ˆå—ï¼Ÿ")) {
            DataModule.resetStats();
            this.renderLeaderboard();
          }
        },

        renderHistory() {
          const list = document.getElementById("history-list");
          list.innerHTML = "";
          DataModule.state.history.forEach((h) => {
            let color = "#D4AF37";
            let typeText = "ç´€éŒ„";
            if (h.type === "truth") {
              color = "#4CAF50";
              typeText = "çœŸå¿ƒè©±";
            } else if (h.type === "dare") {
              color = "#FF5722";
              typeText = "å¤§å†’éšª";
            } else if (h.type === "pass") {
              color = "#C0C0C0";
              typeText = "Pass";
            }

            list.innerHTML += `
                        <div class="list-item" style="border-left: 3px solid ${color}">
                            <div style="font-size: 0.9rem">
                                <div style="color:var(--gold); font-weight:bold; margin-bottom:4px;">${h.player}</div>
                                <div>[${typeText}] ${h.content}</div>
                                <div style="color:#666; font-size:0.7rem; margin-top:2px;">${h.time}</div>
                            </div>
                        </div>`;
          });
        },

        showResult(type) {
          const player = DataModule.getRandomPlayer();
          DataModule.incrementStat(player);

          const displayPlayer = document.getElementById("player-name-slot");
          const displayResult = document.getElementById("display-result");
          const gameInfoBox = document.querySelector(".game-info");

          displayPlayer.innerText = player;

          let content = "";
          let typeText = "";
          let color = "";
          let backgroundGradient = "rgba(0, 0, 0, 0.6)";

          if (type === "pass") {
            content = "æ­å–œï¼ç›´æ¥è·³éï¼Œä¸‹é¢ä¸€ä½ï¼";
            typeText = "Pass";
            color = "#C0C0C0";
            backgroundGradient =
              "linear-gradient(135deg, rgba(212, 175, 55, 0.4) 0%, rgba(0, 0, 0, 0.8) 100%)";
          } else {
            const question = DataModule.getQuestionByType(type);
            if (question) {
              content = question.content;
              typeText = type === "truth" ? "çœŸå¿ƒè©±" : "å¤§å†’éšª";

              if (type === "truth") {
                color = "#4CAF50";
                backgroundGradient =
                  "linear-gradient(135deg, rgba(21, 101, 192, 0.5) 0%, rgba(0, 0, 0, 0.8) 100%)";
              } else {
                color = "#FF5722";
                backgroundGradient =
                  "linear-gradient(135deg, rgba(198, 40, 40, 0.5) 0%, rgba(0, 0, 0, 0.8) 100%)";
              }

              if (question.level === "Adult") content = "ğŸ”¥ " + content;
            } else {
              content = "é¡Œåº«ä¸­æ²’æœ‰æ­¤é¡å‹çš„é¡Œç›®ï¼ˆå¯èƒ½è¢«é›£åº¦ç¯©é¸æ‰äº†ï¼‰ï¼";
              typeText = "ç¼ºé¡Œ";
              color = "#ff6b6b";
            }
          }

          gameInfoBox.style.background = backgroundGradient;
          gameInfoBox.style.transition = "background 0.5s ease";

          displayResult.innerHTML = `<span style="color:${color}">[${typeText}]</span> ${content}`;

          const now = new Date();
          DataModule.addHistory({
            player: player,
            type: type,
            content: content,
            time: `${now.getHours()}:${now
              .getMinutes()
              .toString()
              .padStart(2, "0")}`,
          });
          this.renderHistory();
        },

        renderSettingsValues() {
          const counts = DataModule.state.settings.segmentCounts;
          document.getElementById("val-truth").innerText = counts.truth;
          document.getElementById("val-dare").innerText = counts.dare;
          document.getElementById("val-pass").innerText = counts.pass;

          document.getElementById("range-truth").value = counts.truth;
          document.getElementById("range-dare").value = counts.dare;
          document.getElementById("range-pass").value = counts.pass;

          document.getElementById("speed-range").value =
            DataModule.state.settings.speed;
          document.getElementById("duration-range").value =
            DataModule.state.settings.duration / 1000;
          document.getElementById("game-difficulty-filter").value =
            DataModule.state.settings.difficultyFilter;
        },

        bindEvents() {
          document
            .getElementById("spinBtn")
            .addEventListener("click", () => WheelModule.spin());
          document
            .getElementById("add-player-btn")
            .addEventListener("click", () => this.handleAddPlayer());
          document
            .getElementById("add-q-btn")
            .addEventListener("click", () => this.handleAddQuestion());
          document
            .getElementById("clear-q-btn")
            .addEventListener("click", () => this.handleClearQuestions());
          document
            .getElementById("ai-generate-btn")
            .addEventListener("click", () => this.handleAiGenerate());
          document
            .getElementById("reset-stats-btn")
            .addEventListener("click", () => this.handleResetStats());
          document
            .getElementById("btn-export")
            .addEventListener("click", () => DataModule.exportData());
          const fileInput = document.getElementById("file-import");
          document
            .getElementById("btn-import")
            .addEventListener("click", () => {
              if (confirm("åŒ¯å…¥å°‡æœƒè¦†è“‹ç›®å‰çš„è¨­å®šèˆ‡ç´€éŒ„ï¼Œç¢ºå®šè¦ç¹¼çºŒå—ï¼Ÿ")) {
                fileInput.click();
              }
            });
          fileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
              const success = DataModule.importData(event.target.result);
              if (success) {
                alert("åŒ¯å…¥æˆåŠŸï¼é é¢å°‡é‡æ–°æ•´ç†ã€‚");
                location.reload();
              } else {
                alert("åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤ã€‚");
              }
            };
            reader.readAsText(file);
            e.target.value = "";
          });

          document
            .getElementById("menu-toggle")
            .addEventListener("click", () => this.toggleSidebar());

          document.querySelectorAll(".diff-tab").forEach((tab) => {
            tab.addEventListener("click", (e) => {
              if (tab.parentElement.id === "timer-mode-selector") {
                document
                  .querySelectorAll("#timer-mode-selector .diff-tab")
                  .forEach((t) => t.classList.remove("active"));
                e.target.classList.add("active");
                TimerModule.switchMode(e.target.dataset.mode);
              } else {
                document
                  .querySelectorAll("#diff-selector .diff-tab")
                  .forEach((t) => t.classList.remove("active"));
                e.target.classList.add("active");
                this.renderQuestionList(e.target.dataset.val);
              }
            });
          });
          document
            .getElementById("clear-history-btn")
            .addEventListener("click", () => {
              DataModule.clearHistory();
              this.renderHistory();
            });

          const updateSegments = () => {
            DataModule.state.settings.segmentCounts = {
              truth: parseInt(document.getElementById("range-truth").value),
              dare: parseInt(document.getElementById("range-dare").value),
              pass: parseInt(document.getElementById("range-pass").value),
            };
            DataModule.save();
            this.renderSettingsValues();
            WheelModule.generateSegments();
            WheelModule.draw();
            this.updateSpinButton();
          };

          document
            .getElementById("range-truth")
            .addEventListener("input", updateSegments);
          document
            .getElementById("range-dare")
            .addEventListener("input", updateSegments);
          document
            .getElementById("range-pass")
            .addEventListener("input", updateSegments);

          const speedRange = document.getElementById("speed-range");
          const durRange = document.getElementById("duration-range");
          const diffFilter = document.getElementById("game-difficulty-filter");

          speedRange.addEventListener("change", (e) => {
            DataModule.state.settings.speed = parseInt(e.target.value);
            DataModule.save();
          });
          durRange.addEventListener("change", (e) => {
            DataModule.state.settings.duration =
              parseInt(e.target.value) * 1000;
            DataModule.save();
          });
          diffFilter.addEventListener("change", (e) => {
            DataModule.state.settings.difficultyFilter = e.target.value;
            DataModule.save();
          });
        },

        // æ–°å¢ï¼šéµç›¤äº‹ä»¶ç¶å®š
        bindKeyboardEvents() {
          document.addEventListener("keydown", (e) => {
            // å¦‚æœç„¦é»åœ¨è¼¸å…¥æ¡†ï¼Œä¸è§¸ç™¼å¿«æ·éµ
            const activeTag = document.activeElement.tagName.toLowerCase();
            if (
              activeTag === "input" ||
              activeTag === "select" ||
              activeTag === "textarea"
            ) {
              return;
            }

            if (e.code === "Space") {
              e.preventDefault(); // é˜²æ­¢æ»¾å‹•
              // åªæœ‰åœ¨é¦–é æ‰è§¸ç™¼æ—‹è½‰
              const homePanel = document.getElementById("panel-home");
              if (homePanel.classList.contains("active")) {
                WheelModule.spin();
              }
            } else if (e.code === "Escape") {
              e.preventDefault();
              // æŒ‰ ESC å›åˆ°é¦–é 
              this.switchPanel("panel-home");
            }
          });
        },
      };

      window.onload = () => {
        DataModule.init();
        AudioModule.init();
        WheelModule.init();
        UIModule.init();
        TimerModule.init();
      };
    </script>
  </body>
</html>
