<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¥¢è¯çœŸå¿ƒè©±å¤§å†’éšª v3.0 Ultimate</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script
      src="https://unpkg.com/html5-qrcode"
      type="text/javascript"
    ></script>

    <style>
      /* =========================================
           CSS Variables & Base (v1.0 Style)
           ========================================= */
      :root {
        --gold: #d4af37;
        --gold-light: #f4df87;
        --gold-dark: #aa8c2c;
        --black: #121212;
        --dark-grey: #1e1e1e;
        --text-main: #e0e0e0;
        --silver: #c0c0c0;
        --bronze: #cd7f32;
        --adult-pink: #e91e63;
        --shadow: 0 4px 15px rgba(0, 0, 0, 0.8);
        --transition: all 0.3s ease;
        --sidebar-width: 240px;
        --sidebar-width-collapsed: 80px;
      }

      * {
        box-sizing: border-box;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        font-family: "Noto Sans TC", sans-serif;
        background: radial-gradient(circle at center, #2a2a2a 0%, #000000 100%);
        color: var(--text-main);
        margin: 0;
        padding: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        position: relative;
      }
      body::before {
        content: "";
        position: absolute;
        inset: 0;
        background-image: repeating-linear-gradient(
          45deg,
          rgba(212, 175, 55, 0.05) 0px,
          rgba(212, 175, 55, 0.05) 1px,
          transparent 1px,
          transparent 20px
        );
        z-index: -1;
        pointer-events: none;
      }

      /* =========================================
           Login Overlay (v2.0 Feature)
           ========================================= */
      #login-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.98);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        transition: opacity 0.5s;
      }
      #login-overlay.hidden {
        opacity: 0;
        pointer-events: none;
      }
      .login-box {
        background: var(--dark-grey);
        padding: 40px;
        border-radius: 20px;
        border: 2px solid var(--gold);
        text-align: center;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
      }
      .login-title {
        font-size: 2rem;
        color: var(--gold);
        margin-bottom: 30px;
        font-weight: bold;
        text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
      }
      .mode-btn {
        display: block;
        width: 100%;
        padding: 15px;
        margin: 10px 0;
        border: 1px solid var(--gold);
        background: transparent;
        color: var(--gold);
        font-size: 1.1rem;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }
      .mode-btn:hover {
        background: var(--gold);
        color: #000;
      }
      .mode-btn.primary {
        background: linear-gradient(to right, var(--gold-dark), var(--gold));
        color: #000;
        border: none;
        font-weight: bold;
      }

      /* Join Group Responsive Layout */
      .join-group {
        display: flex;
        gap: 10px;
        margin: 10px 0;
      }
      .btn-scan {
        width: 50px;
        padding: 0 !important;
        display: flex !important;
        align-items: center;
        justify-content: center;
      }
      .btn-join {
        flex: 1;
        margin: 0 !important;
      }
      @media (max-width: 1023px) {
        .login-box {
          padding: 25px 15px;
        }
        .join-group {
          flex-wrap: wrap;
        }
        .btn-join {
          flex: 1 1 100%; /* Full width on mobile */
        }
      }

      /* =========================================
           Layout & Components
           ========================================= */
      header {
        text-align: center;
        padding: 15px;
        border-bottom: 2px solid var(--gold-dark);
        background: rgba(0, 0, 0, 0.8);
        box-shadow: var(--shadow);
        z-index: 10;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }
      #menu-toggle {
        display: none;
        position: absolute;
        left: 20px;
        background: none;
        border: none;
        color: var(--gold);
        cursor: pointer;
        font-size: 24px;
      }

      /* Status Bar (v2.0 Feature) */
      .status-bar {
        position: absolute;
        top: 50%;
        right: 15px;
        transform: translateY(-50%);
        z-index: 20;
        display: flex;
        align-items: center;
        gap: 10px;
        background: rgba(0, 0, 0, 0.6);
        padding: 5px 15px;
        border-radius: 20px;
        border: 1px solid #333;
      }
      .status-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: #666;
        transition: all 0.3s;
      }
      .status-dot.online {
        background: #4caf50;
        box-shadow: 0 0 8px #4caf50;
      }
      .room-code {
        color: var(--gold);
        font-weight: bold;
        font-family: monospace;
        font-size: 1rem;
        letter-spacing: 1px;
      }
      #qr-btn {
        background: none;
        border: none;
        color: var(--gold);
        cursor: pointer;
        padding: 0 5px;
        display: none; /* Hidden by default */
      }

      /* Scanner & QR Modal */
      .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 2000;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .modal-overlay.hidden {
        display: none;
      }
      .modal-box {
        width: 90%;
        max-width: 400px;
        background: var(--dark-grey);
        padding: 20px;
        border-radius: 10px;
        border: 1px solid var(--gold);
        text-align: center;
        position: relative;
      }
      #reader {
        width: 100%;
        background: #000;
        margin-bottom: 15px;
        border-radius: 5px;
        overflow: hidden;
      }
      #qr-image {
        width: 200px;
        height: 200px;
        margin: 10px auto;
        display: block;
      }

      header h1 {
        margin: 0;
        color: var(--gold);
        font-weight: 700;
        letter-spacing: 2px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        font-size: 1.5rem;
      }

      nav {
        display: flex;
        justify-content: space-around;
        background: var(--dark-grey);
        padding: 10px 0;
        border-top: 2px solid var(--gold-dark);
        z-index: 10;
      }
      nav .nav-btn {
        background: none;
        border: none;
        color: #666;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        cursor: pointer;
        transition: var(--transition);
      }
      nav .nav-btn i {
        font-size: 24px;
        margin-bottom: 4px;
      }
      nav .nav-btn span {
        font-size: 12px;
      }
      nav .nav-btn.active,
      nav .nav-btn:hover {
        color: var(--gold);
        text-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
      }

      main {
        flex: 1;
        position: relative;
        overflow: hidden;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
        display: flex;
        justify-content: center;
      }
      .panel {
        position: absolute;
        inset: 0;
        padding: 20px;
        overflow-y: auto;
        opacity: 0;
        transform: translateX(20px);
        pointer-events: none;
        transition: var(--transition);
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        display: none;
      }
      .panel.active {
        opacity: 1;
        transform: translateX(0);
        pointer-events: auto;
        z-index: 5;
        display: block;
      }

      .wheel-container {
        position: relative;
        width: 300px;
        height: 300px;
        margin: 20px auto;
        border-radius: 50%;
        padding: 8px;
        background: conic-gradient(
          #ff0000,
          #ff7f00,
          #ffff00,
          #00ff00,
          #0000ff,
          #4b0082,
          #9400d3,
          #ff0000
        );
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
      }
      .wheel-container canvas {
        width: 100%;
        height: 100%;
        border-radius: 50%;
      }
      .pointer {
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        width: 40px;
        height: 50px;
        z-index: 2;
        filter: drop-shadow(0 4px 4px rgba(0, 0, 0, 0.5));
      }
      .pointer::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          #ffffff 0%,
          #e0e0e0 50%,
          #b0b0b0 100%
        );
        clip-path: polygon(
          30% 0%,
          70% 0%,
          70% 50%,
          100% 50%,
          50% 100%,
          0% 50%,
          30% 50%
        );
      }
      .center-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        background: radial-gradient(circle, var(--gold-light), var(--gold));
        border-radius: 50%;
        border: 2px solid #fff;
        z-index: 2;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      }

      .game-info {
        text-align: center;
        margin-top: 20px;
        background: rgba(0, 0, 0, 0.6);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid var(--gold-dark);
        transition: background 0.5s ease;
      }
      .current-player {
        color: var(--gold-light);
        font-size: 1.2rem;
        margin-bottom: 10px;
      }
      .result-box {
        min-height: 60px;
        font-size: 1.1rem;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
      }

      .btn-main {
        background: linear-gradient(to bottom, var(--gold), var(--gold-dark));
        color: #000;
        border: none;
        padding: 15px 40px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 30px;
        margin: 20px auto;
        display: block;
        width: 80%;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
        transition: transform 0.1s;
      }
      .btn-main:active {
        transform: scale(0.95);
      }
      .btn-main:disabled {
        filter: grayscale(1);
        cursor: not-allowed;
        opacity: 0.5;
      }
      .btn-small {
        background: var(--gold-dark);
        color: #fff;
        border: none;
        padding: 0 15px;
        border-radius: 5px;
        height: 38px;
        cursor: pointer;
      }
      .btn-small.btn-danger {
        background: #8b0000;
      }
      .btn-small.btn-ai {
        background: linear-gradient(45deg, #1e90ff, #00bfff);
        color: white;
      }
      .btn-small.btn-outline {
        background: transparent;
        border: 1px solid var(--gold);
        color: var(--gold);
      }
      .btn-small:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .section-title {
        color: var(--gold);
        border-bottom: 1px solid var(--gold-dark);
        padding-bottom: 5px;
        margin-bottom: 15px;
        font-size: 1.1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .input-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }
      .input-group.input-group--options {
        margin-top: -10px;
      }
      .input-group.input-group--options label {
        color: #888;
        font-size: 0.8rem;
        align-self: center;
      }
      input,
      select {
        flex: 1;
        background: #f9f9f9;
        border: 1px solid var(--gold-dark);
        color: #000;
        padding: 10px;
        border-radius: 5px;
        font-family: inherit;
        font-weight: 500;
      }

      .list-container {
      }
      .list-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 5px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-left: 3px solid transparent;
      }
      .list-item:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      .list-item.truth {
        border-left-color: #4caf50;
      }
      .list-item.dare {
        border-left-color: #ff5722;
      }
      .list-item.pass {
        border-left-color: #c0c0c0;
      }
      .list-item .tag {
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 4px;
        margin-right: 5px;
        background: #333;
        color: #fff;
      }
      .list-item .tag.level-adult {
        background: var(--adult-pink);
        font-weight: bold;
      }
      .delete-btn {
        background: none;
        border: none;
        color: #ff6b6b;
        cursor: pointer;
      }

      /* Host/Guest Controls */
      .guest-hidden {
        display: none !important;
      }
      .host-only {
      } /* Helper class for JS logic */

      /* Rank Styles */
      .rank-1 {
        border-left: 3px solid var(--gold);
        background: linear-gradient(
          90deg,
          rgba(212, 175, 55, 0.2),
          transparent
        );
      }
      .rank-1 .rank-icon {
        color: var(--gold);
        font-size: 1.2rem;
      }
      .rank-2 {
        border-left: 3px solid var(--silver);
        background: linear-gradient(
          90deg,
          rgba(192, 192, 192, 0.15),
          transparent
        );
      }
      .rank-2 .rank-icon {
        color: var(--silver);
        font-size: 1.2rem;
      }
      .rank-3 {
        border-left: 3px solid var(--bronze);
        background: linear-gradient(
          90deg,
          rgba(205, 127, 50, 0.15),
          transparent
        );
      }
      .rank-3 .rank-icon {
        color: var(--bronze);
        font-size: 1.2rem;
      }
      .rank-count {
        font-weight: bold;
        color: var(--gold);
        margin-left: 10px;
      }

      /* Reaction Floating Menu */
      .reaction-wrapper {
        position: fixed;
        right: 20px;
        bottom: 120px;
        z-index: 90;
        display: flex;
        flex-direction: column-reverse;
        align-items: center;
        gap: 10px;
      }
      .reaction-menu {
        display: flex;
        flex-direction: column;
        gap: 8px;
        background: rgba(0, 0, 0, 0.8);
        padding: 8px;
        border-radius: 30px;
        border: 1px solid var(--gold-dark);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        transform-origin: bottom center;
      }
      .reaction-menu.hidden {
        opacity: 0;
        transform: scale(0.5) translateY(20px);
        pointer-events: none;
        height: 0;
        padding: 0;
        overflow: hidden;
      }
      .reaction-toggle {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        background: var(--gold);
        border: none;
        color: #000;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s;
      }
      .reaction-toggle:active {
        transform: scale(0.9);
      }

      .reaction-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--gold-dark);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
        cursor: pointer;
        transition: transform 0.1s;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .reaction-btn:active {
        transform: scale(0.9);
        background: var(--gold);
      }

      /* Timer Styles */
      .timer-display-box {
        text-align: center;
        margin: 30px 0;
      }
      .timer-time {
        font-size: 5rem;
        font-weight: 700;
        color: var(--gold);
        text-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        font-variant-numeric: tabular-nums;
        line-height: 1;
      }
      .timer-controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
      }
      .timer-btn-circle {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        border: 2px solid var(--gold);
        background: rgba(0, 0, 0, 0.5);
        color: var(--gold);
        font-size: 24px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      .timer-btn-circle:hover {
        background: var(--gold);
        color: #000;
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
      }
      .timer-presets {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 20px;
        flex-wrap: wrap;
      }
      .timer-blink {
        animation: blink 1s infinite;
        color: #ff5722;
      }
      @keyframes blink {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.3;
        }
      }

      .difficulty-tabs {
        display: flex;
        margin-bottom: 10px;
        background: #222;
        border-radius: 5px;
        padding: 2px;
      }
      .difficulty-tabs .diff-tab {
        flex: 1;
        text-align: center;
        padding: 8px;
        cursor: pointer;
        font-size: 0.9rem;
        color: #888;
      }
      .difficulty-tabs .diff-tab.active {
        background: var(--gold-dark);
        color: #fff;
        border-radius: 4px;
      }

      .slider-container {
        margin-bottom: 20px;
      }
      .slider-container label {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
        color: #aaa;
      }
      .slider-container input[type="range"] {
        width: 100%;
        cursor: pointer;
        accent-color: var(--gold);
      }
      .slider-container select {
        width: 100%;
      }

      /* Shake Animation */
      @keyframes shake {
        0% {
          transform: translate(1px, 1px) rotate(0deg);
        }
        10% {
          transform: translate(-1px, -2px) rotate(-1deg);
        }
        20% {
          transform: translate(-3px, 0px) rotate(1deg);
        }
        30% {
          transform: translate(3px, 2px) rotate(0deg);
        }
        40% {
          transform: translate(1px, -1px) rotate(1deg);
        }
        50% {
          transform: translate(-1px, 2px) rotate(-1deg);
        }
        60% {
          transform: translate(-3px, 1px) rotate(0deg);
        }
        70% {
          transform: translate(3px, 1px) rotate(-1deg);
        }
        80% {
          transform: translate(-1px, -1px) rotate(1deg);
        }
        90% {
          transform: translate(1px, 2px) rotate(0deg);
        }
        100% {
          transform: translate(1px, -2px) rotate(-1deg);
        }
      }
      .shake-screen {
        animation: shake 0.5s;
        animation-iteration-count: infinite;
      }

      /* Danmaku Layer */
      #danmaku-layer {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
      }
      .danmaku-item {
        position: absolute;
        bottom: -50px;
        font-size: 2rem;
        animation: floatUp 4s linear forwards;
        opacity: 0.8;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      }
      @keyframes floatUp {
        0% {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
        100% {
          transform: translateY(-100vh) scale(1.5);
          opacity: 0;
        }
      }

      @media (min-width: 1024px) {
        body {
          display: grid;
          grid-template-columns: var(--sidebar-width) 1fr;
          grid-template-rows: auto 1fr;
          grid-template-areas: "sidebar header" "sidebar main";
        }
        nav {
          grid-area: sidebar;
          flex-direction: column;
          justify-content: flex-start;
          height: 100vh;
          border-top: none;
          border-right: 2px solid var(--gold-dark);
          padding-top: 20px;
        }
        header {
          grid-area: header;
          padding-left: 0;
          justify-content: center;
        }
        main {
          grid-area: main;
          padding: 0 40px;
        }
        #menu-toggle {
          display: block;
        }
        nav .nav-btn {
          flex-direction: row;
          padding: 18px 30px;
          gap: 20px;
        }
        body.sidebar-collapsed {
          grid-template-columns: var(--sidebar-width-collapsed) 1fr;
        }
        body.sidebar-collapsed nav .nav-btn span {
          display: none;
        }
        body.sidebar-collapsed nav .nav-btn {
          justify-content: center;
          padding: 18px 0;
        }
      }
    </style>
  </head>
  <body>
    <div id="login-overlay">
      <div class="login-box">
        <div class="login-title">
          å¥¢è¯çœŸå¿ƒè©±å¤§å†’éšª<br /><span
            style="font-size: 1rem; font-weight: normal; color: #888"
            >Online Edition v3.0</span
          >
        </div>
        <input
          type="text"
          id="nickname-input"
          placeholder="è«‹è¼¸å…¥ä½ çš„æš±ç¨±"
          style="
            margin-bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 1.1rem;
          "
        />
        <button class="mode-btn primary" onclick="NetworkModule.createRoom()">
          å‰µå»ºæˆ¿é–“ (Host)
        </button>
        <div class="join-group">
          <input
            type="text"
            id="room-code-input"
            placeholder="è¼¸å…¥6ä½æ•¸æˆ¿é–“ç¢¼"
            style="
              background: #333;
              color: #fff;
              border-color: #666;
              text-transform: uppercase;
            "
          />
          <button
            class="mode-btn"
            class="mode-btn btn-scan"
            onclick="ScannerModule.start()"
          >
            <i class="material-icons">qr_code_scanner</i>
          </button>
          <button class="mode-btn btn-join" onclick="NetworkModule.joinRoom()">
            åŠ å…¥
          </button>
        </div>
        <button class="mode-btn" onclick="NetworkModule.startOffline()">
          å–®æ©Ÿæ¨¡å¼
        </button>
      </div>
    </div>

    <!-- Scanner Overlay -->
    <div id="scanner-overlay" class="modal-overlay hidden">
      <div class="modal-box">
        <div style="color: var(--gold); margin-bottom: 10px; font-weight: bold">
          æƒææˆ¿é–“ç¢¼
        </div>
        <div id="reader"></div>
        <button class="btn-small btn-danger" onclick="ScannerModule.stop()">
          é—œé–‰
        </button>
      </div>
    </div>

    <!-- QR Display Overlay -->
    <div id="qr-display-overlay" class="modal-overlay hidden">
      <div class="modal-box">
        <div style="color: var(--gold); margin-bottom: 10px; font-weight: bold">
          æˆ¿é–“ QR Code
        </div>
        <img id="qr-image" src="" alt="Room QR" />
        <button
          class="btn-small btn-danger"
          onclick="document.getElementById('qr-display-overlay').classList.add('hidden')"
        >
          é—œé–‰
        </button>
      </div>
    </div>

    <div id="danmaku-layer"></div>
    <audio id="bgm" loop><source src="bgm.mp3" type="audio/mpeg" /></audio>
    <audio id="sfx-spin"><source src="spin.mp3" type="audio/mpeg" /></audio>
    <audio id="sfx-win"><source src="win.mp3" type="audio/mpeg" /></audio>
    <audio id="sfx-alarm"><source src="alarm.mp3" type="audio/mpeg" /></audio>

    <header>
      <button id="menu-toggle"><i class="material-icons">menu</i></button>
      <div class="status-bar">
        <div id="status-indicator" class="status-dot"></div>
        <span id="room-display" class="room-code">OFFLINE</span>
        <button id="qr-btn" onclick="UIModule.showRoomQR()">
          <i class="material-icons">qr_code</i>
        </button>
      </div>
      <h1>çœŸå¿ƒè©±å¤§å†’éšª</h1>
    </header>

    <main>
      <section id="panel-home" class="panel active">
        <div class="wheel-container">
          <div class="pointer"></div>
          <div class="center-circle"></div>
          <canvas id="wheelCanvas" width="300" height="300"></canvas>
        </div>
        <div class="game-info">
          <div class="current-player" id="display-player">
            <i class="material-icons">person</i>
            <span id="player-name-slot">æº–å‚™é–‹å§‹</span>
          </div>
          <div class="result-box" id="display-result">é»æ“ŠæŒ‰éˆ•æˆ–ç©ºç™½éµæ—‹è½‰</div>
        </div>
        <button id="spinBtn" class="btn-main" disabled>é–‹å§‹æŠ½ç±¤</button>
        <div
          id="guest-msg"
          class="guest-hidden"
          style="text-align: center; color: #888; margin-top: 10px"
        >
          ç­‰å¾…æˆ¿ä¸»æ“ä½œ...
        </div>
      </section>

      <section id="panel-players" class="panel">
        <div class="section-title">
          <span>ç©å®¶åå–® (<span id="player-count">0</span>)</span>
        </div>
        <div class="input-group host-only">
          <input
            type="text"
            id="new-player-input"
            placeholder="è¼¸å…¥ç©å®¶åç¨±..."
          />
          <button id="add-player-btn" class="btn-small">
            <i class="material-icons">add</i>
          </button>
        </div>
        <div id="player-list" class="list-container"></div>
      </section>

      <section id="panel-leaderboard" class="panel">
        <div class="section-title">
          <span>è¢«é¸ä¸­æ¬¡æ•¸æ’è¡Œ</span>
          <button id="reset-stats-btn" class="btn-small btn-danger host-only">
            é‡ç½®
          </button>
        </div>
        <div id="leaderboard-list" class="list-container"></div>
      </section>

      <section id="panel-timer" class="panel">
        <div class="section-title"><span>è¨ˆæ™‚å™¨</span></div>
        <div class="difficulty-tabs" id="timer-mode-selector">
          <div class="diff-tab active" data-mode="countdown">å€’æ•¸è¨ˆæ™‚</div>
          <div class="diff-tab" data-mode="stopwatch">è¨ˆæ™‚ç¢¼éŒ¶</div>
        </div>
        <div class="timer-display-box">
          <div id="timer-display" class="timer-time">00:00</div>
        </div>
        <div
          class="timer-presets"
          id="timer-presets-container"
          style="display: flex"
        >
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(10)"
          >
            +10s
          </button>
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(30)"
          >
            +30s
          </button>
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(60)"
          >
            +1m
          </button>
          <button
            class="btn-small btn-outline"
            onclick="TimerModule.addTime(300)"
          >
            +5m
          </button>
        </div>
        <div class="timer-controls">
          <button
            class="timer-btn-circle"
            id="timer-btn-reset"
            title="é‡ç½®"
            onclick="TimerModule.reset()"
          >
            <i class="material-icons">replay</i>
          </button>
          <button
            class="timer-btn-circle"
            id="timer-btn-start"
            title="é–‹å§‹/æš«åœ"
            style="background: var(--gold); color: #000"
            onclick="TimerModule.toggle()"
          >
            <i class="material-icons" id="timer-icon-play">play_arrow</i>
          </button>
        </div>
      </section>

      <section id="panel-questions" class="panel">
        <div class="section-title">
          <span>å•é¡Œåº«</span>
          <div class="host-only">
            <button
              id="clear-q-btn"
              class="btn-small btn-danger"
              style="margin-right: 5px"
            >
              <i class="material-icons">delete_sweep</i> æ¸…ç©º
            </button>
            <button id="ai-generate-btn" class="btn-small btn-ai">
              <i class="material-icons">auto_awesome</i> AI ç”¢ç”Ÿ
            </button>
          </div>
        </div>
        <div class="difficulty-tabs" id="diff-selector">
          <div class="diff-tab active" data-val="all">å…¨éƒ¨</div>
          <div class="diff-tab" data-val="truth">çœŸå¿ƒè©±</div>
          <div class="diff-tab" data-val="dare">å¤§å†’éšª</div>
        </div>
        <div class="input-group">
          <select id="q-type" style="flex: 0.4">
            <option value="truth">çœŸå¿ƒè©±</option>
            <option value="dare">å¤§å†’éšª</option>
          </select>
          <input type="text" id="new-q-input" placeholder="è¼¸å…¥å•é¡Œ..." />
          <button id="add-q-btn" class="btn-small">
            <i class="material-icons">add</i>
          </button>
        </div>
        <div
          class="input-group input-group--options"
          style="
            margin-top: 15px;
            border-top: 1px solid var(--gold-dark);
            padding-top: 10px;
          "
        >
          <label
            ><i
              class="material-icons"
              style="font-size: 1rem; vertical-align: middle"
              >filter_list</i
            >
            ç¯©é¸ç­‰ç´š:</label
          >
          <select id="list-difficulty-filter">
            <option value="all">å…¨éƒ¨é¡¯ç¤º</option>
            <option value="Easy">ç°¡å–®</option>
            <option value="Normal">æ™®é€š</option>
            <option value="Hard">å›°é›£</option>
            <option value="Adult">å¤§äººå°ˆå±¬</option>
          </select>
        </div>
        <div id="question-list" class="list-container"></div>
      </section>

      <section id="panel-history" class="panel">
        <div class="section-title">
          <span>æ­·å²è¨˜éŒ„</span>
          <button id="clear-history-btn" class="btn-small btn-danger host-only">
            æ¸…é™¤
          </button>
        </div>
        <div id="history-list" class="list-container"></div>
      </section>

      <section id="panel-settings" class="panel">
        <div class="section-title">è½‰ç›¤é…ç½® (Host Only)</div>
        <div class="slider-container">
          <label>çœŸå¿ƒè©±æ ¼æ•¸ <span id="val-truth">10</span></label>
          <input
            type="range"
            id="range-truth"
            min="0"
            max="50"
            value="10"
            class="host-control"
          />
        </div>
        <div class="slider-container">
          <label>å¤§å†’éšªæ ¼æ•¸ <span id="val-dare">10</span></label>
          <input
            type="range"
            id="range-dare"
            min="0"
            max="50"
            value="10"
            class="host-control"
          />
        </div>
        <div class="slider-container">
          <label>Pass æ ¼æ•¸ <span id="val-pass">2</span></label>
          <input
            type="range"
            id="range-pass"
            min="0"
            max="50"
            value="2"
            class="host-control"
          />
        </div>

        <div class="section-title" style="margin-top: 30px">éŠæˆ²ç‰©ç†</div>
        <div class="slider-container">
          <label>æ—‹è½‰é€Ÿåº¦</label>
          <input
            type="range"
            id="speed-range"
            min="10"
            max="50"
            value="30"
            class="host-control"
          />
        </div>
        <div class="slider-container">
          <label>æ—‹è½‰æ™‚é–“ (ç§’)</label>
          <input
            type="range"
            id="duration-range"
            min="2"
            max="10"
            value="5"
            class="host-control"
          />
        </div>
        <div class="slider-container">
          <label>é›£åº¦ç¯©é¸</label>
          <select id="game-difficulty-filter" class="host-control">
            <option value="All">å…¨éƒ¨ (åŒ…å«æ‰€æœ‰)</option>
            <option value="Safe">é—”å®¶å’¸å®œ (ç°¡å–®+æ™®é€š)</option>
            <option value="Standard">æ¨™æº–æ¨¡å¼ (ä¸å«å¤§äºº)</option>
            <option value="Spicy">åˆºæ¿€æ¨¡å¼ (å›°é›£+å¤§äºº)</option>
            <option value="Adult">åƒ…é™å¤§äºº (18+)</option>
          </select>
        </div>
        <div
          class="slider-container"
          style="
            display: flex;
            align-items: center;
            justify-content: space-between;
          "
        >
          <label style="margin: 0">é˜²é‡è¤‡æŠ½ä¸­ (No Repeat)</label>
          <input
            type="checkbox"
            id="check-no-repeat"
            class="host-control"
            style="width: 20px; height: 20px; margin: 0"
          />
        </div>

        <div class="section-title host-only" style="margin-top: 30px">
          è³‡æ–™å‚™ä»½
        </div>
        <div
          class="input-group host-only"
          style="justify-content: space-between"
        >
          <button
            id="btn-export"
            class="btn-small"
            style="flex: 1; margin-right: 5px"
          >
            <i class="material-icons">download</i> åŒ¯å‡ºå‚™ä»½
          </button>
          <button
            id="btn-import"
            class="btn-small btn-outline"
            style="flex: 1; margin-left: 5px"
          >
            <i class="material-icons">upload</i> åŒ¯å…¥å‚™ä»½
          </button>
          <input
            type="file"
            id="file-import"
            style="display: none"
            accept=".json"
          />
        </div>
        <button
          id="btn-reset-default"
          class="btn-small btn-danger host-only"
          style="width: 100%; margin-top: 10px"
        >
          <i class="material-icons">restart_alt</i> æ¢å¾©é è¨­å€¼
        </button>
        <button
          id="btn-leave-room"
          class="btn-small"
          style="
            width: 100%;
            margin-top: 10px;
            background: #444;
            border: 1px solid #666;
          "
        >
          <i class="material-icons">logout</i> é€€å‡ºæˆ¿é–“ / è¿”å›é¦–é 
        </button>
      </section>
    </main>

    <!-- Floating Reaction Menu -->
    <div class="reaction-wrapper">
      <button class="reaction-toggle" onclick="UIModule.toggleReactions()">
        <i class="material-icons">sentiment_satisfied_alt</i>
      </button>
      <div id="reaction-menu" class="reaction-menu hidden">
        <button class="reaction-btn" onclick="NetworkModule.sendReaction('ğŸ‘')">
          ğŸ‘
        </button>
        <button class="reaction-btn" onclick="NetworkModule.sendReaction('ğŸ˜‚')">
          ğŸ˜‚
        </button>
        <button class="reaction-btn" onclick="NetworkModule.sendReaction('ğŸ»')">
          ğŸ»
        </button>
        <button class="reaction-btn" onclick="NetworkModule.sendReaction('ğŸ˜®')">
          ğŸ˜®
        </button>
        <button class="reaction-btn" onclick="NetworkModule.sendReaction('â¤ï¸')">
          â¤ï¸
        </button>
      </div>
    </div>

    <nav>
      <button
        class="nav-btn active"
        onclick="UIModule.switchPanel('panel-home', this)"
      >
        <i class="material-icons">casino</i><span>éŠæˆ²</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-players', this)"
      >
        <i class="material-icons">group</i><span>ç©å®¶</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-leaderboard', this)"
      >
        <i class="material-icons">emoji_events</i><span>æ’è¡Œ</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-timer', this)"
      >
        <i class="material-icons">timer</i><span>è¨ˆæ™‚</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-questions', this)"
      >
        <i class="material-icons">edit_note</i><span>é¡Œåº«</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-history', this)"
      >
        <i class="material-icons">history</i><span>è¨˜éŒ„</span>
      </button>
      <button
        class="nav-btn"
        onclick="UIModule.switchPanel('panel-settings', this)"
      >
        <i class="material-icons">settings</i><span>è¨­å®š</span>
      </button>
    </nav>

    <script>
      /* ==================== Firebase Config ==================== */
      const firebaseConfig = {
        apiKey: "AIzaSyBi-VIoa3swbrQqoeik9y5FtOHheJ3x8KA",
        authDomain: "truth-or-dare-online-v2.firebaseapp.com",
        databaseURL:
          "https://truth-or-dare-online-v2-default-rtdb.firebaseio.com",
        projectId: "truth-or-dare-online-v2",
        storageBucket: "truth-or-dare-online-v2.firebasestorage.app",
        messagingSenderId: "144397063274",
        appId: "1:144397063274:web:5c9e0d2161a1fcdd296613",
        measurementId: "G-86LC0DZ2RS",
      };

      let db = null;
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.database();
      } catch (e) {
        console.warn("Firebase Init Error:", e);
      }

      /* ==================== Network Module ==================== */
      const NetworkModule = {
        roomId: null,
        isHost: false,
        nickname: "åŒ¿å",
        roomRef: null,
        lastProcessedSpinTrigger: 0,
        lastProcessedResultTime: 0,
        pendingResult: null,
        nextSpinner: null,

        createRoom() {
          if (!db) return this.startOffline();
          const name =
            document.getElementById("nickname-input").value.trim() || "Host";
          this.nickname = name;
          this.isHost = true;
          this.roomId = Math.floor(100000 + Math.random() * 900000).toString();

          this.roomRef = db.ref("rooms/" + this.roomId);

          // ä½¿ç”¨ç‰©ä»¶çµæ§‹å„²å­˜ç©å®¶ï¼Œä»¥ä¾¿è™•ç† onDisconnect
          // åˆå§‹åŒ–æˆ¿é–“ï¼Œå°‡ LocalStorage çš„è³‡æ–™æ¨ä¸Šå»
          const initialData = {
            host: name,
            status: "waiting",
            spinTrigger: 0,
            currentResult: null,
            createdAt: firebase.database.ServerValue.TIMESTAMP,
            players: {}, // åˆå§‹åŒ–ç‚ºç©ºç‰©ä»¶ï¼ŒenterGame æœƒåŠ å…¥æˆ¿ä¸»
            questions: DataModule.state.questions, // Sync questions
            settings: DataModule.state.settings, // Sync settings
            history: [],
            stats: {},
            nextSpinner: null,
          };

          this.roomRef.set(initialData).then(() => {
            this.enterGame();
          });
        },

        joinRoom() {
          if (!db) return this.startOffline();
          const code = document.getElementById("room-code-input").value.trim();
          const name =
            document.getElementById("nickname-input").value.trim() || "Guest";
          if (code.length !== 6) return alert("è«‹è¼¸å…¥æ­£ç¢ºçš„6ä½æ•¸æˆ¿é–“ç¢¼");

          this.roomId = code;
          this.nickname = name;
          this.isHost = false;
          this.roomRef = db.ref("rooms/" + this.roomId);

          this.roomRef.once("value").then((snapshot) => {
            if (snapshot.exists()) {
              this.enterGame();
            } else {
              alert("æˆ¿é–“ä¸å­˜åœ¨ï¼");
            }
          });
        },

        startOffline() {
          this.isHost = true;
          this.roomId = "LOCAL";
          this.enterGame();
        },

        enterGame() {
          document.getElementById("login-overlay").classList.add("hidden");
          const roomText = this.isHost
            ? `${this.roomId} (Host)`
            : `${this.roomId}`;
          document.getElementById("room-display").innerText =
            this.roomId === "LOCAL" ? "OFFLINE" : roomText;

          if (this.roomId !== "LOCAL") {
            document.getElementById("status-indicator").classList.add("online");
            document.getElementById("qr-btn").style.display = "inline-block";

            // è¨­å®šç©å®¶ä¸Šç·šèˆ‡æ–·ç·šè‡ªå‹•ç§»é™¤
            // æ›¿æ›ä¸åˆæ³•å­—å…ƒä»¥ä½œç‚º Key
            const safeName = this.nickname.replace(/[.$#\[\]\/]/g, "_");
            const playerRef = this.roomRef.child("players/" + safeName);
            playerRef.set({
              name: this.nickname,
              isHost: this.isHost,
              weight: 1,
            });
            playerRef.onDisconnect().remove();

            this.listenForUpdates();
            this.listenForReactions();
          } else {
            // å–®æ©Ÿæ¨¡å¼ï¼šå¾ local storage åˆå§‹åŒ–
            DataModule.loadFromStorage();
          }

          UIModule.updateRoleUI();

          // å¦‚æœæ˜¯ Hostï¼Œæ¯æ¬¡æœ¬åœ°æ•¸æ“šè®Šå‹•éƒ½ä¸Šå‚³
          // å¦‚æœæ˜¯ Guestï¼ŒaddPlayer åªæ˜¯ç‚ºäº†æ›´æ–°æœ¬åœ°é¡¯ç¤ºï¼ŒçœŸå¯¦åŒæ­¥åœ¨ listenForUpdates
          if (!this.isHost && this.roomId !== "LOCAL") {
            // Guest specific init if needed
          } else {
            // Host: sync local players to UI
            UIModule.renderPlayerList();
          }
        },

        listenForUpdates() {
          // ç›£è½æ‰€æœ‰é‡è¦è³‡æ–™
          this.roomRef.on("value", (snap) => {
            const val = snap.val();
            if (!val) return;

            // Sync Players
            // å°‡ Firebase çš„ç‰©ä»¶çµæ§‹ { key: {name: "A"}, key2: {name: "B"} } è½‰å›é™£åˆ— ["A", "B"]
            // v3.1 Update: Sync objects {name, weight}
            const serverPlayersObj = val.players || {};

            // Security Check: If I'm a guest and not in the list, I've been kicked
            if (!this.isHost && this.roomId !== "LOCAL") {
              const safeName = this.nickname.replace(/[.$#\[\]\/]/g, "_");
              if (!serverPlayersObj[safeName]) {
                alert("ä½ å·²è¢«æˆ¿ä¸»ç§»é™¤æˆ¿é–“");
                this.leaveRoom();
                return;
              }
            }

            const serverPlayersList = Object.values(serverPlayersObj).map(
              (p) => ({
                name: p.name,
                weight: p.weight !== undefined ? p.weight : 1,
              })
            );

            if (
              JSON.stringify(DataModule.state.players) !==
              JSON.stringify(serverPlayersList)
            ) {
              DataModule.state.players = serverPlayersList;
              UIModule.renderPlayerList();
              if (
                document
                  .getElementById("panel-leaderboard")
                  .classList.contains("active")
              ) {
                UIModule.renderLeaderboard();
              }
            }

            // Sync Questions
            const serverQuestions = val.questions || [];
            if (
              JSON.stringify(DataModule.state.questions) !==
              JSON.stringify(serverQuestions)
            ) {
              DataModule.state.questions = serverQuestions;
              DataModule.saveToStorage();
              UIModule.renderQuestionList();
            }

            // Sync Settings
            if (!this.isHost && val.settings) {
              DataModule.state.settings = val.settings;
              UIModule.renderSettingsValues();
              WheelModule.generateSegments();
              WheelModule.draw();
            }

            // Sync History
            if (val.history) {
              DataModule.state.history = val.history;
              UIModule.renderHistory();
            }

            // Sync Stats
            const serverStats = val.stats || {};
            if (
              JSON.stringify(DataModule.state.stats) !==
              JSON.stringify(serverStats)
            ) {
              DataModule.state.stats = serverStats;
              if (
                document
                  .getElementById("panel-leaderboard")
                  .classList.contains("active")
              ) {
                UIModule.renderLeaderboard();
              }
            }

            // Sync Spin
            if (
              val.spinTrigger &&
              val.spinTrigger > this.lastProcessedSpinTrigger
            ) {
              this.lastProcessedSpinTrigger = val.spinTrigger;
              if (
                val.spinTrigger > Date.now() - 10000 &&
                !WheelModule.isSpinning
              ) {
                WheelModule.spin(false);
              }
            }

            // Sync Result
            if (
              !this.isHost &&
              val.currentResult &&
              val.currentResult.timestamp > this.lastProcessedResultTime
            ) {
              this.lastProcessedResultTime = val.currentResult.timestamp;
              if (WheelModule.isSpinning) {
                this.pendingResult = val.currentResult;
              } else {
                UIModule.showResult(
                  val.currentResult.type,
                  val.currentResult.content,
                  val.currentResult.player
                );
              }
            }

            // Sync Next Spinner
            if (val.nextSpinner !== undefined) {
              this.nextSpinner = val.nextSpinner;
              UIModule.updateSpinPermission();
            }
          });
        },

        listenForReactions() {
          // Listen for new reactions
          // Use limitToLast(1) to avoid fetching huge history,
          // and check timestamp to ignore old ones on initial load.
          this.roomRef
            .child("reactions")
            .limitToLast(1)
            .on("child_added", (snap) => {
              const val = snap.val();
              if (!val) return;
              // Allow 5 seconds buffer. If older than 5s, ignore.
              if (Date.now() - val.ts < 5000) {
                UIModule.showReaction(val.emoji);
              }
            });
        },

        leaveRoom() {
          if (this.roomId !== "LOCAL" && this.roomRef) {
            // ç§»é™¤ç·šä¸Šç©å®¶ç¯€é»
            const safeName = this.nickname.replace(/[.$#\[\]\/]/g, "_");
            this.roomRef.child("players/" + safeName).remove();
            this.roomRef.off(); // åœæ­¢ç›£è½
          }

          this.roomId = null;
          this.isHost = false;
          this.roomRef = null;

          // é‡ç½® UI èˆ‡ç‹€æ…‹
          document.getElementById("login-overlay").classList.remove("hidden");
          document.getElementById("room-display").innerText = "OFFLINE";
          document
            .getElementById("status-indicator")
            .classList.remove("online");
          document.getElementById("qr-btn").style.display = "none";
        },

        sendReaction(emoji) {
          if (this.roomId !== "LOCAL" && this.roomRef) {
            this.roomRef.child("reactions").push({
              emoji: emoji,
              sender: this.nickname,
              ts: firebase.database.ServerValue.TIMESTAMP,
            });
          } else {
            // Local mode: just show it
            UIModule.showReaction(emoji);
          }
        },

        // Update Helpers
        pushUpdate(key, data) {
          if (this.roomId === "LOCAL" || !this.roomRef) return;
          // Only Host should push most structural changes, but Guests trigger spins via Host or receive updates
          // Here we assume simple trust: whoever changes state pushes it if allowed.
          if (this.isHost || key === "questions") {
            this.roomRef.update({ [key]: data });
          }
        },
      };

      /* ==================== Data Module ==================== */
      const DataModule = {
        key: "luxuryTOD_v3",
        defaultDB: [
          {
            type: "truth",
            content: "ä½ çš„æ‰‹æ©Ÿæ¡Œå¸ƒæ˜¯ä»€éº¼ï¼Ÿç‚ºä»€éº¼é¸é€™å¼µï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "å¦‚æœä¸­æ¨‚é€é ­çï¼Œç¬¬ä¸€ä»¶äº‹åšä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "ä½ ç¡è¦ºæœ‰ä»€éº¼æ€ªç™–ï¼Ÿï¼ˆæ‰“å‘¼ã€æµå£æ°´ã€æŠ±è¢«å­...ï¼‰",
            level: "Easy",
          },
          { type: "truth", content: "æœ€è¿‘ä¸€æ¬¡å“­æ˜¯å› ç‚ºä»€éº¼ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±åƒå“ªç¨®å‹•ç‰©ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "ä½ æœ€æ€•å“ªç¨®æ˜†èŸ²æˆ–å‹•ç‰©ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœèƒ½æœ‰è¶…èƒ½åŠ›ï¼Œä½ æƒ³è¦ä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "å°æ™‚å€™çš„å¤¢æƒ³è·æ¥­æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "å»KTVå¿…é»çš„ä¸€é¦–æ­Œæ˜¯ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "æ´—æ¾¡æ™‚æœƒåšçš„æœ€å¥‡æ€ªçš„ä¸€ä»¶äº‹ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "èº«ä¸Šå“ªå€‹éƒ¨ä½æœ€æ»¿æ„ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "èªªå‡ºä¸€å€‹ä½ çµ•å°ä¸æ•¢åƒçš„é£Ÿç‰©ã€‚",
            level: "Easy",
          },
          { type: "truth", content: "ä½ è¦ºå¾—åœ¨å ´èª°æœ€è‡ªæˆ€ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "ä¸Šä¸€æ¬¡å°¿åºŠæ˜¯å¹¾æ­²ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "è²·éæœ€å¾Œæ‚”çš„æ±è¥¿æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœæ˜å¤©æ˜¯ä¸–ç•Œæœ«æ—¥ï¼Œä½ æœƒåƒä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "ä½ ç›¸ä¿¡é€™ä¸–ä¸Šæœ‰é¬¼å—ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "åšéæœ€å¥‡æ€ªçš„å¤¢æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "ä½ çš„æ‹¿æ‰‹èœæ˜¯ä»€éº¼ï¼Ÿï¼ˆæ³¡éºµä¹Ÿç®—ï¼‰",
            level: "Easy",
          },
          { type: "truth", content: "æœ€å–œæ­¡çš„ä¸€éƒ¨é›»å½±æ˜¯ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±å¿ƒç†å¹´é½¡å¹¾æ­²ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœå¯ä»¥è·Ÿåœ¨å ´ä¸€äººäº¤æ›èº«ä»½ä¸€å¤©ï¼Œæƒ³é¸èª°ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "èªªå‡ºä¸€ä»¶ä½ å°æ™‚å€™åšéçš„è ¢äº‹ã€‚",
            level: "Easy",
          },
          {
            type: "truth",
            content: "ä½ æœ‰å¤šå°‘å¤©æ²’æ´—é ­çš„æœ€é«˜ç´€éŒ„ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "è¦ºå¾—åœ¨å ´èª°çœ‹èµ·ä¾†è„¾æ°£æœ€å¥½ï¼Ÿ",
            level: "Easy",
          },
          { type: "dare", content: "æ¨¡ä»¿ä¸€ç¨®å‹•ç‰©ç›´åˆ°ä¸‹ä¸€è¼ªã€‚", level: "Easy" },
          { type: "dare", content: "åšé¬¼è‡‰è‡ªæ‹ä¸€å¼µã€‚", level: "Easy" },
          { type: "dare", content: "æ¨¡ä»¿ä¸€ç¨®å‹•ç‰©çš„å«è²ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "å°è‘—çª—å¤–å¤§å–Šï¼šã€Œæˆ‘æ˜¯ç¬¨è›‹ï¼ã€",
            level: "Easy",
          },
          {
            type: "dare",
            content: "åŸåœ°è½‰ 10 åœˆï¼Œç„¶å¾Œèµ°ç›´ç·šã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ æ‰‹æ©Ÿè£¡ç¬¬ 5 å¼µç…§ç‰‡ã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "ç”¨ã€Œå–µã€ä»£æ›¿ã€Œæˆ‘ã€èªªè©±ä¸‰åˆ†é˜ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "æ¨¡ä»¿åœ¨å ´æŸå€‹äººçš„å£é ­ç¦ªã€‚", level: "Easy" },
          { type: "dare", content: "èª‡çå³é‚Šçš„äººä¸‰å€‹å„ªé»ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "å”±ä¸€é¦–å…’æ­Œï¼ˆä¾‹å¦‚å…©éš»è€è™ï¼‰ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "ç”¨å±è‚¡å¯«å­—ï¼ˆä½ çš„åå­—ï¼‰ã€‚", level: "Easy" },
          { type: "dare", content: "è®“å·¦é‚Šçš„äººå¹«ä½ æ•´ç†é ­é«®ã€‚", level: "Easy" },
          { type: "dare", content: "é›™æ‰‹èˆ‰é«˜ç¶­æŒä¸€åˆ†é˜ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "å’Œå³é‚Šçš„äººåæŒ‡ç·Šæ‰£ 10 ç§’ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "æ¨¡ä»¿åæ¨¡èµ°å°æ­¥ä¸€åœˆã€‚", level: "Easy" },
          { type: "dare", content: "è¬›ä¸€å€‹å†·ç¬‘è©±ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "è·Ÿå¤§å®¶åˆ†äº«ä½ æœ€è¿‘çš„ä¸€å€‹æœå°‹ç´€éŒ„ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "å°è‘—é¡å­ç¨±è®šè‡ªå·± 30 ç§’ã€‚", level: "Easy" },
          { type: "dare", content: "å­¸å¬°å…’å“­ 10 ç§’ã€‚", level: "Easy" },
          { type: "dare", content: "å–ä¸€å¤§æ¯æ°´ã€‚", level: "Easy" },
          { type: "dare", content: "è®“å¤§å®¶æª¢æŸ¥ä½ çš„åŒ…åŒ…ã€‚", level: "Easy" },
          {
            type: "truth",
            content: "æ›¾ç¶“å‡è£ç”Ÿç—…è«‹å‡å»åšä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°çš„è¡£å“æœ€å·®ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "æ‰‹æ©Ÿè£¡æœ€é†œçš„ä¸€å¼µç…§ç‰‡æ˜¯èª°ï¼Ÿï¼ˆå¿…é ˆå±•ç¤ºï¼‰",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å·çœ‹éèª°çš„æ‰‹æ©Ÿæˆ–æ—¥è¨˜ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "èªªå‡ºä½ åœ¨å ´æœ€æƒ³åæ§½çš„ä¸€å€‹äººã€‚",
            level: "Normal",
          },
          {
            type: "truth",
            content: "åœ¨å ´é€™ç¾¤äººä¸­ï¼Œä½ è¦ºå¾—èª°å°‡ä¾†æœƒæœ€å¯Œæœ‰ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨æ¸¸æ³³æ± å·å°¿å°¿éå—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "ä¸Šä¸€æ¬¡æ”¾å±ä¸å°å¿ƒå´©å‡ºã€Œæ±è¥¿ã€æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "å¦‚æœä½ æ˜¯ç•°æ€§ï¼Œä½ æœƒæƒ³è·Ÿè‡ªå·±äº¤å¾€å—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“æŠŠåˆ¥äººé€çš„ç¦®ç‰©è½‰é€å‡ºå»å—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "è¦ºå¾—åœ¨å ´èª°æœ€å®¹æ˜“è¢«è©é¨™ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "èªªå‡ºä¸€å€‹ä½ ä¸æƒ³è®“çˆ¶æ¯çŸ¥é“çš„ç§˜å¯†ã€‚",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨å…¬å…±å ´åˆåšéæœ€ä¸Ÿè‡‰çš„äº‹ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "è¦ºå¾—å“ªå€‹å¡é€šäººç‰©æœ€æ€§æ„Ÿï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "å¦‚æœè¦åˆªé™¤ä¸€ä½åœ¨å ´å¥½å‹çš„è¯çµ¡æ–¹å¼ï¼Œé¸èª°ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å°è€é—†æˆ–è€å¸«èªªéæœ€å¤§çš„è¬Šï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ´—è¡£æœæœƒæŠŠå…§è¤²è·Ÿè¥ªå­ä¸€èµ·æ´—å—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å·åƒéåˆ¥äººçš„æ±è¥¿æ²’æ‰¿èªå—ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€æœƒè¨˜ä»‡ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ‰æ²’æœ‰æŒ–é¼»å­”åƒä¸‹å»éï¼Ÿ", level: "Normal" },
          {
            type: "dare",
            content: "éš¨æ©Ÿæ‰“çµ¦é€šè¨ŠéŒ„ä¸€å€‹äººå”±ç”Ÿæ—¥å¿«æ¨‚æ­Œã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨å±è‚¡æ’åœ¨å ´æ¯å€‹äººçš„å±è‚¡ä¸€ä¸‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å«è‘—æ°´å“¼ä¸€é¦–æ­Œè®“å¤§å®¶çŒœã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è·³ä¸€æ®µç›®å‰æœ€ç´…çš„æŠ–éŸ³èˆã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è®“å³é‚Šçš„äººæ”ä½ ç™¢ 10 ç§’é˜ï¼Œä¸èƒ½ç¬‘ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨ä½ çš„æ‰‹è‚˜æ‰“å­—ç™¼ä¸€å‰‡å‹•æ…‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è·ªåœ¨æ¤…å­ä¸Šæ¨¡ä»¿å¤ä»£äººè«‹å®‰ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "å¤¾è‘—é¼»å­èªªè©±ä¸€è¼ªã€‚", level: "Normal" },
          {
            type: "dare",
            content: "æŠŠé‹å­è„«ä¸‹ä¾†ï¼Œèä¸€ä¸‹ä¸¦å½¢å®¹å‘³é“ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å»å»šæˆ¿ç‰¹èª¿ä¸€æ¯ã€Œæ€ªå‘³é£²æ–™ã€ä¸¦å–ä¸€å£ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "æ‰“çµ¦åª½åª½èªªï¼šã€Œæˆ‘å¥½åƒå–œæ­¡ä¸ŠåŒæ€§äº†ã€ï¼ˆè¨˜å¾—è§£é‡‹ï¼‰ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "è®“åœ¨å ´æ¯å€‹äººå½ˆä½ é¡é ­ä¸€ä¸‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å‡è£é›»è¦–è³¼ç‰©æ¨éŠ·ä½ ç©¿çš„è¥ªå­ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å°è‘—Siriå¤§å–Šã€Œæˆ‘å¥½å¯‚å¯ã€ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "èƒŒè‘—å³é‚Šçš„äººç¹æˆ¿é–“ä¸€åœˆã€‚",
            level: "Normal",
          },
          { type: "truth", content: "èªªå‡ºä½ åšéæœ€é•æ³•çš„äº‹æƒ…ã€‚", level: "Hard" },
          {
            type: "truth",
            content: "é€™è¼©å­æœ€å¾Œæ‚”çš„ä¸€ä»¶äº‹æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "å¦‚æœç”Ÿå‘½åªå‰©24å°æ™‚ï¼Œæƒ³å°èª°èªªä»€éº¼ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æˆé•·éç¨‹ä¸­ï¼Œå“ªä»¶äº‹å°ä½ çš„åƒ¹å€¼è§€å½±éŸ¿æœ€å¤§ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "ä½ æœ€å®³æ€•å¤±å»ä»€éº¼ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æ›¾ç¶“å°æœ‹å‹çš„å¦ä¸€åŠå‹•éå¿ƒå—ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€é›£ç›¸è™•ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "å¦‚æœå¿…é ˆè·Ÿåœ¨å ´ä¸€å€‹äººçµ•äº¤ï¼Œä½ æœƒé¸èª°ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä¸Šä¸€æ¬¡ç™¼è‡ªå…§å¿ƒå¤§å“­æ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä½ è¦ºå¾—è‡ªå·±æœ€å¤§çš„ç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æœ‰æ²’æœ‰å“ªå€‹å¤¢æƒ³æ˜¯ä½ å·²ç¶“æ”¾æ£„çš„ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è®“å¤§å®¶ç€è¦½ä½ çš„ç€è¦½å™¨æœå°‹ç´€éŒ„ï¼ˆæœ€è¿‘3æ¢ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å»å†°ç®±æ‹¿ä¸€é¡†å†°å¡Šï¼Œæ”¾åœ¨è¡£æœè£¡ç›´åˆ°èåŒ–ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "åœ¨ä¸€ä½ç•°æ€§èº«ä¸Šåšä¼åœ°æŒºèº« 5 ä¸‹ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ æ‰‹æ©Ÿç›¸ç°¿è£¡æœ€æ–°çš„é‚£å¼µæˆªåœ–ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è·Ÿå¤§å®¶åˆ†äº«ä½ å…§è¤²çš„é¡è‰²å’Œæ¬¾å¼ï¼ˆå¿…é ˆæª¢æŸ¥ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å…¬ä¸»æŠ±ï¼ˆæˆ–è¢«å…¬ä¸»æŠ±ï¼‰ä¸€ä½ç•°æ€§åšæ·±è¹² 3 ä¸‹ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ“æŠ±åœ¨ä½ å³é‚Šçš„äºº 20 ç§’ï¼Œä»€éº¼è©±éƒ½ä¸èƒ½èªªã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ‰“é›»è©±çµ¦ä¸€ä½å¥½ä¹…æ²’è¯çµ¡çš„æœ‹å‹ï¼Œèªªæƒ³ä»–äº†ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "é¸ä¸€å€‹äººï¼Œå¹«ä»–æŒ‰æ‘© 3 åˆ†é˜ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "åœ¨ç¤¾ç¾¤åª’é«”ä¸Šç™¼ä¸€ç¯‡æ„Ÿè¬æ–‡ï¼Œæ„Ÿè¬åœ¨å ´çš„ä¸€å€‹äººã€‚",
            level: "Hard",
          },
          {
            type: "truth",
            content: "åœ¨å ´çš„ç•°æ€§ä¸­ï¼Œèª°æœ€æ¥è¿‘ä½ çš„æ€§å¹»æƒ³å°è±¡ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "ç¬¬ä¸€æ¬¡ç™¼ç”Ÿæ€§è¡Œç‚ºæ˜¯åœ¨å¹¾æ­²ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“æœ‰éä¸€å¤œæƒ…å—ï¼Ÿæˆ–è€…æƒ³å˜—è©¦å—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "èƒ½å¤ æ¥å—çš„å¹´é½¡å·®æœ€å¤§æ˜¯å¤šå°‘ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "å–œæ­¡é–‹ç‡ˆé‚„æ˜¯é—œç‡ˆè¾¦äº‹ï¼Ÿ", level: "Adult" },
          { type: "dare", content: "è¦ªå»ä½ å·¦é‚Šç©å®¶çš„è„–å­ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "é¸ä¸€ä½ç•°æ€§ï¼Œç”¨å˜´å°å˜´å‚³éä¸€å¼µè¡›ç”Ÿç´™ï¼ˆæˆ–å†°å¡Šï¼‰ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "åœ¨åœ¨å ´ç•°æ€§ä¸­é¸ä¸€ä½ï¼Œåœ¨ä»–è€³é‚Šå¹æ°£ä¸¦èªªæ‚„æ‚„è©±ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“ä¸€ä½ç•°æ€§ååœ¨ä½ å¤§è…¿ä¸Š 1 åˆ†é˜ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "å°è‘—ä¸€ä½ç•°æ€§åšå‡ºæŒ‘é€—çš„åƒé¦™è•‰ï¼ˆæˆ–æ‰‹æŒ‡ï¼‰å‹•ä½œã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“å³é‚Šçš„äººåœ¨ä½ è„–å­ä¸Šç¨®è‰è“ï¼ˆæˆ–å‡è£ç”¨åŠ›å¸ä¸€ä¸‹ï¼‰ã€‚",
            level: "Adult",
          },
          // ğŸŸ¢ New Easy Questions
          {
            type: "truth",
            content: "æœ€å–œæ­¡çš„å­£ç¯€æ˜¯å“ªå€‹ï¼Ÿç‚ºä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "ä½ æ¯”è¼ƒå–œæ­¡è²“é‚„æ˜¯ç‹—ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "æ—©é¤é€šå¸¸éƒ½åƒä»€éº¼ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "æœ€è¿‘çœ‹çš„ä¸€æœ¬æ›¸æˆ–æ¼«ç•«æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "ä½ æœ€å–œæ­¡çš„é¡è‰²æ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "ä½ ç›¸ä¿¡æ˜Ÿåº§æˆ–ç®—å‘½å—ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "å–œæ­¡å–å’–å•¡é‚„æ˜¯èŒ¶ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœå¯ä»¥å‡ºåœ‹ï¼Œç¾åœ¨æœ€æƒ³å»å“ªè£¡ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "å‡æ—¥é€šå¸¸å–œæ­¡åšä»€éº¼ä¼‘é–’æ´»å‹•ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "æœ‰æ²’æœ‰æ”¶é›†ä»€éº¼ç‰¹åˆ¥çš„æ±è¥¿ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "æœ€å–œæ­¡çš„æ°´æœæ˜¯ä»€éº¼ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "å–œæ­¡çˆ¬å±±é‚„æ˜¯å»æµ·é‚Šï¼Ÿ", level: "Easy" },
          { type: "truth", content: "æ•¢ä¸æ•¢åƒæ¦´æ§¤æˆ–è‡­è±†è…ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¹³æ™‚å–œæ­¡è½ä»€éº¼é¡å‹çš„éŸ³æ¨‚ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "æœ€è¿‘ä¸€æ¬¡å»ä¾¿åˆ©å•†åº—è²·äº†ä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          { type: "dare", content: "åšä¸€å€‹æœ€é†œçš„é¬¼è‡‰ã€‚", level: "Easy" },
          { type: "dare", content: "æ¨¡ä»¿è²“å«ä¸‰è²ã€Œå–µå–µå–µã€ã€‚", level: "Easy" },
          { type: "dare", content: "ç«™èµ·ä¾†åŸåœ°è½‰ä¸€åœˆã€‚", level: "Easy" },
          { type: "dare", content: "è·Ÿå·¦é‚Šçš„äººæ“ŠæŒã€‚", level: "Easy" },
          {
            type: "dare",
            content: "èªªä¸€å€‹ç¬‘è©±ï¼ˆä¸å¥½ç¬‘ä¹Ÿè¦ç¬‘ï¼‰ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "é–‰çœ¼å–®è…³ç«™ç«‹5ç§’ã€‚", level: "Easy" },
          { type: "dare", content: "æ¨¡ä»¿æ©Ÿå™¨äººèªªè©±ä¸€å¥ã€‚", level: "Easy" },
          { type: "dare", content: "å°è‘—ç©ºæ°£æ®æ‰‹èªªã€Œå—¨ã€ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "åšå‡ºä¸€å€‹é©šè¨çš„è¡¨æƒ…ç¶­æŒ5ç§’ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "æ¨¡ä»¿ä¸€ç¨®æ¨‚å™¨çš„è²éŸ³ã€‚", level: "Easy" },
          // ğŸŸ¡ New Normal Questions
          { type: "truth", content: "å­¸ç”Ÿæ™‚ä»£æ›¾ç¶“ä½œå¼Šéå—ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "ä¸Šä¸€æ¬¡ç”Ÿæ°£æ˜¯å› ç‚ºä»€éº¼äº‹æƒ…ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "è¦ºå¾—è‡ªå·±æœ€å¤§çš„å„ªé»æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "è¦ºå¾—è‡ªå·±æœ€å¤§çš„ç¼ºé»æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "æ›¾ç¶“å°å¥½æœ‹å‹èªªéè¬Šå—ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "æœ‰æ²’æœ‰æš—æˆ€éè€å¸«æˆ–é•·è¼©ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "ç¬¬ä¸€æ¬¡ç´„æœƒå»äº†å“ªè£¡ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "æœ€è¨å­çš„ä¸€ç¨®é£Ÿç‰©æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨é›»å½±é™¢çœ‹é›»å½±çœ‹åˆ°ç¡è‘—éå—ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "æ•¢ä¸æ•¢ä¸€å€‹äººçœ‹ææ€–ç‰‡ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "æ›¾ç¶“è¿·è·¯éæœ€ä¹…çš„ä¸€æ¬¡æ˜¯å¤šä¹…ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "å°æ™‚å€™æœ€æ€•ä»€éº¼æ±è¥¿ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "æ›¾ç¶“ä¸å°å¿ƒæŠŠåˆ¥äººçš„ç§˜å¯†èªªå‡ºå»å—ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€å¹½é»˜å¥½ç¬‘ï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "å¦‚æœèƒ½å›åˆ°éå»ï¼Œæœ€æƒ³å›åˆ°å¹¾æ­²ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨å±è‚¡åœ¨ç©ºä¸­å¯«æ•¸å­—ã€Œ8ã€ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "æ¨¡ä»¿åœ¨å ´æŸäººçš„ç¬‘è²ã€‚", level: "Normal" },
          {
            type: "dare",
            content: "è®“å³é‚Šçš„äººå¹«ä½ æ•´ç†é ­é«®ï¼ˆæˆ–æ‘¸é ­ï¼‰ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "å°è‘—æ‰‹æ©Ÿé¡é ­æ·±æƒ…å‘Šç™½ï¼ˆå°è±¡éš¨æ„ï¼‰ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "å”±ä¸€é¦–å…’æ­Œçš„å‰¯æ­Œã€‚", level: "Normal" },
          {
            type: "dare",
            content: "ç”¨éæ…£ç”¨æ‰‹å¯«ä¸‹è‡ªå·±çš„åå­—ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "æ¨¡ä»¿æ®­å±è·³ä¸‰ä¸‹ã€‚", level: "Normal" },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ éŒ¢åŒ…è£¡æœ‰å¤šå°‘éŒ¢ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "éš¨æ©Ÿå¿µå‡ºæ‰‹æ©Ÿè£¡çš„ä¸€æ¢ç°¡è¨Šå…§å®¹ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "æ¨¡ä»¿æ–°èä¸»æ’­æ’­å ±æ°£è±¡ã€‚", level: "Normal" },
          // ğŸ”´ New Hard Questions
          { type: "truth", content: "æ›¾ç¶“èƒŒå›éå¥½æœ‹å‹å—ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "èªªå‡ºä¸€å€‹ä½ å¾æœªå‘Šè¨´éåˆ¥äººçš„ç§˜å¯†ã€‚",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å·éæ±è¥¿å—ï¼ˆä¸è«–å¤§å°ï¼‰ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "å°åœ¨å ´èª°çš„ç¬¬ä¸€å°è±¡æœ€å·®ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æ›¾ç¶“æƒ³éè¦æ•´å‹å—ï¼Ÿæƒ³æ•´å“ªè£¡ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "è¦ºå¾—è‡ªå·±äººç”Ÿä¸­æœ€å¤±æ•—çš„ä¸€ä»¶äº‹ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "æ›¾ç¶“è…³è¸å…©æ¢èˆ¹å—ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "è¨å­åœ¨å ´æŸäººçš„æŸå€‹è¡Œç‚ºå—ï¼Ÿè«‹èª å¯¦ã€‚",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å·çœ‹éå¦ä¸€åŠçš„æ‰‹æ©Ÿè¨Šæ¯å—ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "å¦‚æœå¿…é ˆæ®ºæ­»ä¸€å€‹äººæ‰èƒ½æ•‘è‡ªå·±ï¼Œä½ æœƒé¸èª°ï¼ˆå‡è¨­æƒ…å¢ƒï¼‰ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "æ›¾ç¶“å¾Œæ‚”è·ŸæŸä»»äº¤å¾€å—ï¼Ÿ", level: "Hard" },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±æ˜¯ä¸æ˜¯ä¸€å€‹å¥½äººï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æ›¾ç¶“ç‚ºäº†åˆ©ç›Šå‡ºè³£éæœ‹å‹å—ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "èªªå‡ºä¸€å€‹ä½ æœ€æƒ³åˆªé™¤çš„é»‘æ­·å²ã€‚",
            level: "Hard",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨èƒŒå¾Œèªªéåœ¨å ´èª°çš„å£è©±ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ‰“é›»è©±çµ¦å‰ä»»ï¼ˆæˆ–éš¨æ©Ÿç•°æ€§æœ‹å‹ï¼‰èªªã€Œæˆ‘å¥½æƒ³ä½ ã€ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è®“å·¦é‚Šçš„äººåœ¨ä½ çš„è‡‰ä¸Šç•«ä¸€å€‹åœ–æ¡ˆã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content:
              "éš¨æ©ŸæŒ‘é¸é€šè¨ŠéŒ„çš„ä¸€å€‹äººï¼Œå‚³é€ã€Œæˆ‘æ‡·å­•äº†/æˆ‘è®“åˆ¥äººæ‡·å­•äº†ã€ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ æ‰‹æ©Ÿç€è¦½å™¨ç´€éŒ„çš„æœ€å¾Œä¸€é ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "æ¨¡ä»¿ä¸€ç¨®çŒ¥ç‘£çš„è¡¨æƒ…è‡ªæ‹ä¸¦ç™¼åˆ°ç¾¤çµ„ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è·ªåœ¨åœ°ä¸Šå‘åœ¨å ´çš„ä¸€å€‹äººæ±‚å©šã€‚",
            level: "Hard",
          },
          { type: "dare", content: "è®“å³é‚Šçš„äººèä½ çš„è…‹ä¸‹ã€‚", level: "Hard" },
          {
            type: "dare",
            content: "å–ä¸€æ¯ç‰¹èª¿é£²æ–™ï¼ˆå¤§å®¶éš¨æ„åŠ æ–™ï¼‰ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å¤§è²å–Šå‡ºè‡ªå·±æœ€ä¸Ÿè‡‰çš„ç¶½è™Ÿã€‚",
            level: "Hard",
          },
          { type: "dare", content: "æ¨¡ä»¿é«˜æ½®çš„è¡¨æƒ…10ç§’ã€‚", level: "Hard" },
          // ğŸ” New Adult Questions
          { type: "truth", content: "å–œæ­¡ä»€éº¼é«”ä½ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æ›¾ç¶“åœ¨å…¬å…±å ´æ‰€åšéå—ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "æœ€å–œæ­¡èº«é«”å“ªå€‹éƒ¨ä½è¢«è§¸æ‘¸ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å¹»æƒ³éè·Ÿåœ¨å ´èª°ç™¼ç”Ÿé—œä¿‚ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "æ¥å—ä¸€å¤œæƒ…å—ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "æ›¾ç¶“æœ‰éæ€§å¹»æƒ³å°è±¡æ˜¯è€å¸«æˆ–ä¸Šå¸å—ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "å–œæ­¡ç²—æš´ä¸€é»é‚„æ˜¯æº«æŸ”ä¸€é»ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "æ›¾ç¶“ä½¿ç”¨éæƒ…è¶£ç©å…·å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "è¦ºå¾—å°ºå¯¸é‡è¦å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æ›¾ç¶“åœ¨åšçš„æ™‚å€™ç¡è‘—å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "å–œæ­¡å£äº¤å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æ›¾ç¶“è¢«æŠ“åŒ…éè‡ªæ…°å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "å–œæ­¡è¢«ç¶èµ·ä¾†å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æ›¾ç¶“ç©éè§’è‰²æ‰®æ¼”å—ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "è¦ºå¾—æ€§æ„›ä¸­æœ€é‡è¦çš„ç’°ç¯€æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Adult",
          },
          { type: "dare", content: "ç™¼å‡ºå‘»åŸè²10ç§’ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "å°è‘—åœ¨å ´ä¸€ä½ç•°æ€§åšå‡ºæŒ‘é€—å‹•ä½œã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“åœ¨å ´ä¸€ä½ç•°æ€§æ‘¸ä½ çš„å¤§è…¿å…§å´ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "æ¨¡ä»¿ä¸€ç¨®æ€§æ„›å§¿å‹¢ï¼ˆå°è‘—ç©ºæ°£ï¼‰ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è„«æ‰ä¸€ä»¶è¡£æœï¼ˆå¤–å¥—æˆ–é…ä»¶ï¼‰ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "è¦ªå»åœ¨å ´ä¸€ä½ç•°æ€§çš„è€³æœµã€‚", level: "Adult" },
          {
            type: "dare",
            content: "è®“åœ¨å ´ä¸€ä½ç•°æ€§ååœ¨ä½ èº«ä¸Šåšä¼åœ°æŒºèº«ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "ç”¨å˜´å·´è§£é–‹åœ¨å ´ä¸€ä½ç•°æ€§çš„æ‰£å­ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "éš”è‘—è¡£æœæ’«æ‘¸åœ¨å ´ä¸€ä½ç•°æ€§çš„èƒ¸éƒ¨/è…¹è‚Œã€‚",
            level: "Adult",
          },
          { type: "dare", content: "èªªä¸€å¥ä½ è¦ºå¾—æœ€è‰²çš„è©±ã€‚", level: "Adult" },
          // ğŸŸ¢ New Added Questions (v3.1 Expansion)
          {
            type: "truth",
            content: "å¦‚æœå¯ä»¥æ•´å‹ï¼Œä½ æœ€æƒ³æ•´å“ªè£¡ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "ä½ è¦ºå¾—åœ¨å ´èª°æœ€é©åˆç•¶ä½ çš„å¦ä¸€åŠï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "æ›¾ç¶“è¢«åŠˆè…¿éå—ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "å¦‚æœä¸€å®šè¦è·Ÿåœ¨å ´ä¸€å€‹äººæ¥å»ï¼Œä½ æœƒé¸èª°ï¼Ÿ",
            level: "Hard",
          },
          {
            type: "truth",
            content: "ä½ è¦ºå¾—è‡ªå·±æ€§èƒ½åŠ›å¦‚ä½•ï¼ˆ1-10åˆ†ï¼‰ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "æœ€è¿‘ä¸€æ¬¡DIYæ˜¯ä»€éº¼æ™‚å€™ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "çœ‹éæœ€å¥‡æ€ªçš„Aç‰‡é¡å‹æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Adult",
          },
          { type: "truth", content: "æ›¾ç¶“åœ¨å¿ƒè£¡å·å·è©›å’’éèª°ï¼Ÿ", level: "Hard" },
          { type: "truth", content: "ä½ è¦ºå¾—åœ¨å ´èª°æœ€è™›å½ï¼Ÿ", level: "Hard" },
          { type: "truth", content: "æœ‰æ²’æœ‰æ¬ éŒ¢ä¸é‚„éï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "ä¸Šå»æ‰€å®Œæœƒçœ‹ä¸€çœ¼æ’æ³„ç‰©å—ï¼Ÿ",
            level: "Easy",
          },
          { type: "truth", content: "æ´—æ¾¡æœƒé †ä¾¿å°¿å°¿å—ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœè®Šæˆç•°æ€§ï¼Œç¬¬ä¸€ä»¶äº‹æƒ³åšä»€éº¼ï¼Ÿ",
            level: "Easy",
          },
          {
            type: "truth",
            content: "æœ€æƒ³åˆªé™¤çš„ä¸€å¼µç…§ç‰‡æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“å°æœ‹å‹çš„ç”·/å¥³æœ‹å‹å‹•å¿ƒéå—ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "èªªå‡ºä¸€å€‹ä½ è¨å­çš„è—äººã€‚", level: "Normal" },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€æ„›è¨˜ä»‡ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ‰æ²’æœ‰å·çœ‹éä¼´ä¾¶çš„æ‰‹æ©Ÿï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æ›¾ç¶“è·Ÿä¸å–œæ­¡çš„äººäº¤å¾€éå—ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "åˆå»æ˜¯åœ¨å¹¾æ­²ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ€å°·å°¬çš„ä¸€æ¬¡ç´„æœƒç¶“é©—ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ‰æ²’æœ‰è¢«åŒæ€§å‘Šç™½éï¼Ÿ", level: "Normal" },
          {
            type: "truth",
            content: "è¦ºå¾—è‡ªå·±å“ªå€‹éƒ¨ä½æœ€æ€§æ„Ÿï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "æ›¾ç¶“è£¸ç¡éå—ï¼Ÿ", level: "Easy" },
          {
            type: "truth",
            content: "å¦‚æœä¸­äº†ä¸€å„„ï¼Œæœƒåˆ†çµ¦åœ¨å ´çš„äººå—ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "æœ€å—ä¸äº†ç•°æ€§å“ªå€‹è¡Œç‚ºï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æ›¾ç¶“ç‚ºäº†æ„›åšéæœ€å‚»çš„äº‹ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æœ‰æ²’æœ‰ç•¶éç¬¬ä¸‰è€…ï¼ˆæˆ–è¢«ç•¶éï¼‰ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "è¦ºå¾—æ€§é‡è¦é‚„æ˜¯æ„›é‡è¦ï¼Ÿ", level: "Adult" },
          {
            type: "truth",
            content: "å–œæ­¡è¢«æ§åˆ¶é‚„æ˜¯æ§åˆ¶å°æ–¹ï¼Ÿ",
            level: "Adult",
          },
          {
            type: "truth",
            content: "æ›¾ç¶“åœ¨å¤¢è£¡å¤¢éåœ¨å ´çš„äººå—ï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "å¦‚æœä¸–ç•Œæœ«æ—¥ï¼Œåªèƒ½æ•‘ä¸€å€‹äººï¼Œæ•‘èª°ï¼Ÿ",
            level: "Hard",
          },
          { type: "truth", content: "æœ€æƒ³è·Ÿèª°é“æ­‰ï¼Ÿ", level: "Hard" },
          {
            type: "truth",
            content: "æœ‰æ²’æœ‰èªªéè¬Šä¾†é€ƒé¿èšæœƒï¼Ÿ",
            level: "Normal",
          },
          {
            type: "truth",
            content: "æœ€è¿‘ä¸€å€‹æœå°‹çš„é—œéµå­—æ˜¯ä»€éº¼ï¼Ÿ",
            level: "Normal",
          },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±è°æ˜å—ï¼Ÿ", level: "Easy" },
          { type: "truth", content: "æœ€å–œæ­¡çš„ä¸€é“èœï¼Ÿ", level: "Easy" },
          { type: "truth", content: "æœ‰æ²’æœ‰ä»€éº¼æ€ªç™–ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æ›¾ç¶“è¢«è­¦å¯Ÿæ””ä¸‹ä¾†éå—ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ€å®³æ€•çš„ä¸€ç¨®æ­»æ³•ï¼Ÿ", level: "Hard" },
          { type: "truth", content: "è¦ºå¾—åœ¨å ´èª°æœ€å–®ç´”ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æ›¾ç¶“å·æ‹¿éå®¶è£¡çš„éŒ¢å—ï¼Ÿ", level: "Normal" },
          { type: "truth", content: "æœ‰æ²’æœ‰å‡è£é«˜æ½®éï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æœ€å–œæ­¡çš„æ„›æ„›æ™‚é–“é•·åº¦ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æ›¾ç¶“åœ¨è»Šä¸Šåšéå—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "å–œæ­¡ç©¿ä¸å­—è¤²å—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æœ‰æ²’æœ‰æ‹éç§å¯†ç…§ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "æ›¾ç¶“è·Ÿç¶²å‹ç´„ç‚®éå—ï¼Ÿ", level: "Adult" },
          { type: "truth", content: "è¦ºå¾—è‡ªå·±çš„é¡å€¼å¹¾åˆ†ï¼Ÿ", level: "Normal" },
          { type: "dare", content: "æ¨¡ä»¿ä¸€ç¨®å‹•ç‰©çš„æ±‚å¶èˆã€‚", level: "Easy" },
          { type: "dare", content: "ç”¨å±è‚¡å¯«ã€Œæˆ‘æ„›ä½ ã€ã€‚", level: "Easy" },
          { type: "dare", content: "èå³é‚Šäººçš„è¥ªå­ã€‚", level: "Normal" },
          { type: "dare", content: "è®“å·¦é‚Šçš„äººç•«ä½ çš„è‡‰ã€‚", level: "Normal" },
          {
            type: "dare",
            content: "å°è‘—çª—å¤–å¤§å–Šã€Œæˆ‘æ˜¯å¤§ç¬¨è›‹ã€ã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "è·Ÿåœ¨å ´ä¸€ä½ç•°æ€§åæŒ‡ç·Šæ‰£ä¸€åˆ†é˜ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "å…¬ä¸»æŠ±åœ¨å ´ä¸€ä½ç•°æ€§ã€‚", level: "Hard" },
          {
            type: "dare",
            content: "ä¼åœ°æŒºèº«10ä¸‹ï¼ˆå¯ä»¥åœ¨äººèº«ä¸Šï¼‰ã€‚",
            level: "Hard",
          },
          { type: "dare", content: "è·³ä¸€æ®µæ€§æ„Ÿçš„èˆè¹ˆã€‚", level: "Normal" },
          {
            type: "dare",
            content: "ç”¨å˜´å·´å’¬ä¸‹å·¦é‚Šäººèº«ä¸Šçš„ä¾¿åˆ©è²¼ã€‚",
            level: "Hard",
          },
          { type: "dare", content: "ç™¼å‡ºæ›–æ˜§çš„è²éŸ³10ç§’ã€‚", level: "Adult" },
          { type: "dare", content: "è¦ªå»å³é‚Šäººçš„æ‰‹èƒŒã€‚", level: "Normal" },
          {
            type: "dare",
            content: "è®“å¤§å®¶çœ‹ä½ æ‰‹æ©Ÿè£¡æœ€è¿‘çš„ä¸€å¼µè‡ªæ‹ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "æ¨¡ä»¿åœ¨å ´ä¸€å€‹äººçš„èªªè©±æ–¹å¼ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "å°è‘—é¡å­çŒœæ‹³ç›´åˆ°è´ç‚ºæ­¢ã€‚", level: "Easy" },
          { type: "dare", content: "å–ä¸€æ¯åŠ äº†é¹½çš„å¯æ¨‚ã€‚", level: "Hard" },
          {
            type: "dare",
            content: "è®“åœ¨å ´çš„äººå¹«ä½ ç¶é ­é«®ï¼ˆæˆ–å¼„äº‚ï¼‰ã€‚",
            level: "Easy",
          },
          { type: "dare", content: "è·Ÿç‰†å£æ·±æƒ…å‘Šç™½30ç§’ã€‚", level: "Easy" },
          { type: "dare", content: "æ¨¡ä»¿ä¾¿ç§˜æ™‚çš„è¡¨æƒ…ã€‚", level: "Easy" },
          {
            type: "dare",
            content: "ç”¨èˆŒé ­èˆ”æ‰‹è‚˜ï¼ˆèˆ”ä¸åˆ°ä¹Ÿè¦è©¦ï¼‰ã€‚",
            level: "Easy",
          },
          {
            type: "dare",
            content: "è®“å³é‚Šçš„äººååœ¨ä½ èƒŒä¸Šåšä¼åœ°æŒºèº«ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "è·Ÿå·¦é‚Šçš„äººå°è¦–30ç§’ä¸èƒ½ç¬‘ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "æŠŠé ­åƒæ›æˆé¬¼è‡‰ç…§ä¸€å¤©ã€‚", level: "Hard" },
          {
            type: "dare",
            content: "å‚³è¨Šæ¯çµ¦ç¬¬10å€‹è¯çµ¡äººèªªã€Œå€Ÿæˆ‘éŒ¢ã€ã€‚",
            level: "Hard",
          },
          {
            type: "dare",
            content: "å¤§è²æœ—è®€æ‰‹æ©Ÿè£¡æœ€æ–°çš„ä¸€å‰‡è¨Šæ¯ã€‚",
            level: "Normal",
          },
          {
            type: "dare",
            content: "ç”¨å±è‚¡æ’æ“Šåœ¨å ´æ‰€æœ‰äººçš„å±è‚¡ã€‚",
            level: "Normal",
          },
          { type: "dare", content: "æ¨¡ä»¿é«˜æ½®çš„å«è²ã€‚", level: "Adult" },
          { type: "dare", content: "å°è‘—ç•°æ€§åšé ‚èƒ¯å‹•ä½œ10ä¸‹ã€‚", level: "Adult" },
          { type: "dare", content: "è®“ç•°æ€§æ‘¸ä½ çš„è…¹è‚Œ/è‚šå­ã€‚", level: "Adult" },
          { type: "dare", content: "è¦ªå»ç•°æ€§çš„é–éª¨ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "ç”¨å˜´å·´è§£é–‹ç•°æ€§çš„ä¸€é¡†æ‰£å­ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "åœ¨ç•°æ€§è€³é‚Šå¹æ°£ã€‚", level: "Adult" },
          { type: "dare", content: "è®“ç•°æ€§ååœ¨ä½ å¤§è…¿ä¸Š30ç§’ã€‚", level: "Adult" },
          { type: "dare", content: "éš”è‘—è¡£æœè¦ªå»ç•°æ€§çš„èƒ¸å£ã€‚", level: "Adult" },
          { type: "dare", content: "è¡¨æ¼”åƒé¦™è•‰ï¼ˆæˆ–æ˜¯æ‰‹æŒ‡ï¼‰ã€‚", level: "Adult" },
          { type: "dare", content: "è®“ç•°æ€§å¹«ä½ è„«è¥ªå­ã€‚", level: "Adult" },
          { type: "dare", content: "ç”¨å˜´å·´é¤µç•°æ€§åƒæ±è¥¿ã€‚", level: "Adult" },
          { type: "dare", content: "èººåœ¨åœ°ä¸Šè®“ç•°æ€§è·¨éå»ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "æ¨¡ä»¿AVå¥³å„ª/ç”·å„ªçš„ç¶“å…¸å°è©ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "è®“ç•°æ€§æ‰“ä½ çš„å±è‚¡ä¸€ä¸‹ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "æ¡ä½ç•°æ€§çš„æ‰‹æ”¾åœ¨è‡ªå·±èƒ¸å£ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "è·Ÿç•°æ€§ç£¨é¼»å­10ç§’ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "ç”¨å¾ˆè‰²çš„èªæ°£èªªã€Œæˆ‘è¦åƒæ‰ä½ ã€ã€‚",
            level: "Adult",
          },
          {
            type: "dare",
            content: "è®“ç•°æ€§æª¢æŸ¥ä½ çš„å…§è¡£/å…§è¤²é¡è‰²ã€‚",
            level: "Adult",
          },
          { type: "dare", content: "å°è‘—ç•°æ€§è·³Må­—è…¿ã€‚", level: "Adult" },
          { type: "dare", content: "å«è‘—å†°å¡Šè¦ªå»ç•°æ€§çš„æ‰‹ã€‚", level: "Adult" },
          { type: "dare", content: "è®“ç•°æ€§èä½ çš„è„–å­ã€‚", level: "Adult" },
          {
            type: "dare",
            content: "ç”¨é ˜å¸¶æˆ–çš®å¸¶è¼•è¼•ç¶ä½ç•°æ€§çš„æ‰‹ã€‚",
            level: "Adult",
          },
        ],
        state: {
          players: [],
          questions: [],
          history: [],
          stats: {},
          settings: {
            speed: 30,
            duration: 5000,
            difficultyFilter: "All",
            segmentCounts: { truth: 10, dare: 10, pass: 2 },
            noRepeat: false,
          },
        },
        tempSelected: [],
        init() {
          // Default init
          this.state.questions = [...this.defaultDB];
          this.loadFromStorage();
        },
        loadFromStorage() {
          const saved = localStorage.getItem(this.key);
          if (saved) {
            const parsed = JSON.parse(saved);
            this.state = { ...this.state, ...parsed };
            // Migration for old difficulty filter
            if (this.state.settings.difficultyFilter === "Any")
              this.state.settings.difficultyFilter = "All";
            // Migration for players (string -> object)
            if (
              this.state.players.length > 0 &&
              typeof this.state.players[0] === "string"
            ) {
              this.state.players = this.state.players.map((name) => ({
                name,
                weight: 1,
              }));
            }
            // Migration for noRepeat
            if (this.state.settings.noRepeat === undefined) {
              this.state.settings.noRepeat = false;
            }
          }
        },
        saveToStorage() {
          localStorage.setItem(this.key, JSON.stringify(this.state));
        },
        resetToDefault() {
          if (
            confirm("ç¢ºå®šè¦æ¢å¾©é è¨­å€¼å—ï¼Ÿæ‰€æœ‰è‡ªè¨‚é¡Œç›®ã€ç©å®¶èˆ‡ç´€éŒ„å°‡è¢«æ¸…é™¤ã€‚")
          ) {
            localStorage.removeItem(this.key);
            location.reload();
          }
        },
        // Methods modified to sync with Network
        addPlayer(name) {
          if (NetworkModule.roomId !== "LOCAL") {
            // ç·šä¸Šæ¨¡å¼ï¼šå¯«å…¥ç¯€é»
            const safeName = name.replace(/[.$#\[\]\/]/g, "_");
            NetworkModule.roomRef
              .child("players/" + safeName)
              .set({ name: name, isHost: false, weight: 1 });
            return true;
          } else if (!this.state.players.some((p) => p.name === name)) {
            // å–®æ©Ÿæ¨¡å¼
            this.state.players.push({ name: name, weight: 1 });
            this.saveToStorage();
            UIModule.renderPlayerList();
            if (
              document
                .getElementById("panel-leaderboard")
                .classList.contains("active")
            ) {
              UIModule.renderLeaderboard();
            }
            return true;
          }
          return false;
        },
        removePlayer(index) {
          const p = this.state.players[index];
          if (!p) return;
          const name = p.name;

          if (NetworkModule.roomId !== "LOCAL") {
            // ç·šä¸Šæ¨¡å¼ï¼šç§»é™¤ç¯€é»
            const safeName = name.replace(/[.$#\[\]\/]/g, "_");
            NetworkModule.roomRef.child("players/" + safeName).remove();
          } else {
            // å–®æ©Ÿæ¨¡å¼
            this.state.players.splice(index, 1);
            this.saveToStorage();
            UIModule.renderPlayerList();
            if (
              document
                .getElementById("panel-leaderboard")
                .classList.contains("active")
            ) {
              UIModule.renderLeaderboard();
            }
          }
        },
        updatePlayerWeight(index, weight) {
          const w = parseInt(weight);
          if (isNaN(w) || w < 0) return;
          const p = this.state.players[index];
          if (!p) return;

          if (NetworkModule.roomId !== "LOCAL") {
            const safeName = p.name.replace(/[.$#\[\]\/]/g, "_");
            NetworkModule.roomRef
              .child("players/" + safeName)
              .update({ weight: w });
          } else {
            p.weight = w;
            this.saveToStorage();
          }
        },
        addQuestion(q) {
          this.state.questions.push(q);
          this.saveToStorage();
          NetworkModule.pushUpdate("questions", this.state.questions);
          UIModule.renderQuestionList();
        },
        removeQuestion(index) {
          this.state.questions.splice(index, 1);
          this.saveToStorage();
          NetworkModule.pushUpdate("questions", this.state.questions);
          UIModule.renderQuestionList();
        },
        clearQuestions() {
          this.state.questions = [];
          this.saveToStorage();
          NetworkModule.pushUpdate("questions", this.state.questions);
          UIModule.renderQuestionList();
        },
        addHistory(item) {
          this.state.history.unshift(item);
          if (this.state.history.length > 50) this.state.history.pop();
          this.saveToStorage();
          NetworkModule.pushUpdate("history", this.state.history);
        },
        clearHistory() {
          this.state.history = [];
          this.saveToStorage();
          NetworkModule.pushUpdate("history", this.state.history);
        },
        incrementStat(name) {
          if (!this.state.stats) this.state.stats = {};
          this.state.stats[name] = (this.state.stats[name] || 0) + 1;
          this.saveToStorage();
          NetworkModule.pushUpdate("stats", this.state.stats);
        },
        resetStats() {
          this.state.stats = {};
          this.saveToStorage();
          if (NetworkModule.roomId !== "LOCAL" && NetworkModule.roomRef) {
            NetworkModule.roomRef.child("stats").remove();
          }
          UIModule.renderLeaderboard();
        },
        updateSettings() {
          this.saveToStorage();
          NetworkModule.pushUpdate("settings", this.state.settings);
        },

        // Helpers
        getQuestionByType(type) {
          let filtered = this.state.questions.filter((q) => q.type === type);
          const filterLevel = this.state.settings.difficultyFilter;

          if (filterLevel === "Safe") {
            filtered = filtered.filter((q) =>
              ["Easy", "Normal"].includes(q.level)
            );
          } else if (filterLevel === "Standard") {
            filtered = filtered.filter((q) =>
              ["Easy", "Normal", "Hard"].includes(q.level)
            );
          } else if (filterLevel === "Spicy") {
            filtered = filtered.filter((q) =>
              ["Hard", "Adult"].includes(q.level)
            );
          } else if (filterLevel === "Adult") {
            filtered = filtered.filter((q) => q.level === "Adult");
          }
          // "All" returns everything

          if (filtered.length === 0) return { content: "ç„¡ç¬¦åˆæ¢ä»¶çš„é¡Œç›®" };
          return filtered[Math.floor(Math.random() * filtered.length)];
        },
        getRandomPlayer() {
          if (this.state.players.length === 0) return "åŒ¿åç©å®¶";

          let candidates = this.state.players;

          // No Repeat Logic
          if (this.state.settings.noRepeat) {
            // Filter out players who are already in tempSelected
            // Ensure tempSelected only contains current valid players
            this.tempSelected = this.tempSelected.filter((name) =>
              this.state.players.some((p) => p.name === name)
            );

            const unpicked = this.state.players.filter(
              (p) => !this.tempSelected.includes(p.name)
            );

            if (unpicked.length === 0) {
              // All picked, reset
              this.tempSelected = [];
              candidates = this.state.players;
            } else {
              candidates = unpicked;
            }
          }

          const totalWeight = candidates.reduce(
            (sum, p) => sum + (p.weight || 0),
            0
          );
          let selectedName = "";

          if (totalWeight <= 0) {
            selectedName =
              candidates[Math.floor(Math.random() * candidates.length)].name;
          } else {
            let r = Math.random() * totalWeight;
            for (const p of candidates) {
              const w = p.weight || 0;
              if (r < w) {
                selectedName = p.name;
                break;
              }
              r -= w;
            }
            if (!selectedName)
              selectedName = candidates[candidates.length - 1].name;
          }

          if (this.state.settings.noRepeat) {
            this.tempSelected.push(selectedName);
          }

          return selectedName;
        },
        aiGenerate() {
          const types = ["truth", "dare"];
          const newQ = {
            type: types[Math.floor(Math.random() * 2)],
            content: `(AIç”Ÿæˆ) è«‹è©³ç´°æè¿°ä½ å°${Math.floor(
              Math.random() * 100
            )}è™Ÿè©±é¡Œçš„çœ‹æ³•ã€‚`,
            level: "Normal",
          };
          this.addQuestion(newQ);
          return true;
        },
        exportData() {
          const dataStr = JSON.stringify(this.state, null, 2);
          const blob = new Blob([dataStr], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `backup_${Date.now()}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
        },
        importData(jsonStr) {
          try {
            const data = JSON.parse(jsonStr);
            if (data.players && data.questions) {
              // Migration
              if (
                data.players.length > 0 &&
                typeof data.players[0] === "string"
              ) {
                data.players = data.players.map((name) => ({
                  name,
                  weight: 1,
                }));
              }
              this.state = data;
              this.saveToStorage();
              // If Host, sync to everyone
              if (NetworkModule.isHost) {
                NetworkModule.pushUpdate("players", this.state.players);
                NetworkModule.pushUpdate("questions", this.state.questions);
                NetworkModule.pushUpdate("settings", this.state.settings);
              }
              return true;
            }
          } catch (e) {}
          return false;
        },
      };

      /* ==================== Wheel Module ==================== */
      const WheelModule = {
        canvas: null,
        ctx: null,
        segments: [],
        angleCurrent: 0,
        angleDelta: 0,
        isSpinning: false,
        spinTime: 0,
        spinTimeTotal: 0,
        requestFrameId: null,

        init() {
          this.canvas = document.getElementById("wheelCanvas");
          this.ctx = this.canvas.getContext("2d");
          this.generateSegments();
          this.draw();
        },
        generateSegments() {
          const { truth, dare, pass } = DataModule.state.settings.segmentCounts;
          const tPool = Array(parseInt(truth)).fill({
            text: "çœŸå¿ƒè©±",
            type: "truth",
            color: "#1565C0",
            txtColor: "#FFF",
          });
          const dPool = Array(parseInt(dare)).fill({
            text: "å¤§å†’éšª",
            type: "dare",
            color: "#C62828",
            txtColor: "#FFF",
          });
          const pPool = Array(parseInt(pass)).fill({
            text: "Pass",
            type: "pass",
            color: "#D4AF37",
            txtColor: "#000",
          });

          let combined = [];
          const max = Math.max(truth, dare, pass);
          for (let i = 0; i < max; i++) {
            if (tPool[i]) combined.push(tPool[i]);
            if (dPool[i]) combined.push(dPool[i]);
            if (pPool[i]) combined.push(pPool[i]);
          }
          if (combined.length === 0)
            combined.push({
              text: "è¨­å®š",
              type: "pass",
              color: "#888",
              txtColor: "#FFF",
            });
          this.segments = combined;
        },
        draw() {
          const ctx = this.ctx;
          const w = this.canvas.width;
          const h = this.canvas.height;
          const cx = w / 2;
          const cy = h / 2;
          const radius = w / 2 - 10;
          const count = this.segments.length;
          const arc = (Math.PI * 2) / count;

          ctx.clearRect(0, 0, w, h);
          for (let i = 0; i < count; i++) {
            const angle = this.angleCurrent + i * arc;
            const seg = this.segments[i];
            ctx.fillStyle = seg.color;
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.arc(cx, cy, radius, angle, angle + arc);
            ctx.fill();
            ctx.save();
            ctx.translate(
              cx + Math.cos(angle + arc / 2) * (radius - 50),
              cy + Math.sin(angle + arc / 2) * (radius - 50)
            );
            ctx.rotate(angle + arc / 2 + Math.PI / 2);
            ctx.fillStyle = seg.txtColor;
            ctx.font = 'bold 14px "Noto Sans TC"';
            ctx.fillText(seg.text, -ctx.measureText(seg.text).width / 2, 0);
            ctx.restore();
          }
        },
        spin(isInitiator = true) {
          // åœæ­¢éœ‡å‹•èˆ‡é¬§é˜ç›¸é—œæ•ˆæœ
          if (navigator.vibrate) navigator.vibrate(0);
          document.body.classList.remove("shake-screen");
          document
            .getElementById("timer-display")
            .classList.remove("timer-blink");
          AudioModule.stop("alarm");

          if (this.isSpinning) return;
          this.isSpinning = true;
          document.querySelector(".game-info").style.background =
            "rgba(0, 0, 0, 0.6)";

          if (isInitiator) {
            // Host triggers network event
            if (
              NetworkModule.roomRef &&
              (NetworkModule.isHost ||
                NetworkModule.nickname === NetworkModule.nextSpinner)
            ) {
              NetworkModule.roomRef.update({
                spinTrigger: firebase.database.ServerValue.TIMESTAMP,
              });
            }
          }

          const speedMult = DataModule.state.settings.speed / 10;
          this.spinTime = 0;
          this.spinTimeTotal =
            DataModule.state.settings.duration * (0.8 + Math.random() * 0.4);
          this.angleDelta = (Math.random() * 10 + 20) * speedMult;
          AudioModule.play("spin");
          this.rotate();
        },
        rotate() {
          this.spinTime += 30;
          if (this.spinTime >= this.spinTimeTotal) {
            this.stop();
            return;
          }
          const spinAngle =
            this.angleDelta -
            this.angleDelta * (this.spinTime / this.spinTimeTotal);
          this.angleCurrent += (spinAngle * Math.PI) / 180;
          this.draw();
          this.requestFrameId = requestAnimationFrame(this.rotate.bind(this));
        },
        stop() {
          this.isSpinning = false;
          cancelAnimationFrame(this.requestFrameId);
          AudioModule.stop("spin");
          AudioModule.play("win");

          const count = this.segments.length;
          const arc = (Math.PI * 2) / count;
          const rotation = this.angleCurrent % (Math.PI * 2);
          let index = Math.floor((Math.PI * 1.5 - rotation) / arc);
          index = ((index % count) + count) % count;
          const result = this.segments[index];

          // åªæœ‰æˆ¿ä¸»è² è²¬å¯«å…¥çµæœèˆ‡çµ±è¨ˆ
          if (NetworkModule.isHost) {
            const player = DataModule.getRandomPlayer();
            let content =
              result.type === "pass"
                ? "ç›´æ¥è·³éï¼"
                : DataModule.getQuestionByType(result.type).content;

            DataModule.incrementStat(player);
            DataModule.addHistory({
              player,
              type: result.type,
              content,
              time: new Date().toLocaleTimeString("en-GB", {
                hour: "2-digit",
                minute: "2-digit",
              }),
            });

            if (NetworkModule.roomRef) {
              NetworkModule.roomRef.update({
                currentResult: {
                  type: result.type,
                  content,
                  player,
                  timestamp: firebase.database.ServerValue.TIMESTAMP,
                },
                nextSpinner: player,
              });
            }
            UIModule.showResult(result.type, content, player);
          } else if (NetworkModule.roomId === "LOCAL") {
            // å–®æ©Ÿæ¨¡å¼
            const player = DataModule.getRandomPlayer();
            let content =
              result.type === "pass"
                ? "ç›´æ¥è·³éï¼"
                : DataModule.getQuestionByType(result.type).content;
            DataModule.incrementStat(player);
            DataModule.addHistory({
              player,
              type: result.type,
              content,
              time: new Date().toLocaleTimeString("en-GB", {
                hour: "2-digit",
                minute: "2-digit",
              }),
            });
            UIModule.showResult(result.type, content, player);
          } else {
            // è¨ªå®¢ï¼šåªé¡¯ç¤ºç‰¹æ•ˆï¼Œç­‰å¾… Firebase çš„ currentResult åŒæ­¥å…§å®¹
            EffectModule.triggerConfetti();
            if (NetworkModule.pendingResult) {
              UIModule.showResult(
                NetworkModule.pendingResult.type,
                NetworkModule.pendingResult.content,
                NetworkModule.pendingResult.player
              );
              NetworkModule.pendingResult = null;
            }
          }
        },
      };

      /* ==================== UI & Audio & Effect ==================== */
      const UIModule = {
        currentQuestionFilter: "all",
        init() {
          this.bindEvents();
          this.renderSettingsValues();
          this.updateSpinPermission();
          WheelModule.init();
          AudioModule.init();
        },
        bindEvents() {
          document
            .getElementById("spinBtn")
            .addEventListener("click", () => WheelModule.spin(true));
          document
            .getElementById("menu-toggle")
            .addEventListener("click", () =>
              document.body.classList.toggle("sidebar-collapsed")
            );
          document
            .getElementById("add-player-btn")
            .addEventListener("click", () => {
              const input = document.getElementById("new-player-input");
              if (input.value) {
                DataModule.addPlayer(input.value);
                input.value = "";
              }
            });
          document.getElementById("add-q-btn").addEventListener("click", () => {
            const input = document.getElementById("new-q-input");
            if (input.value) {
              DataModule.addQuestion({
                type: document.getElementById("q-type").value,
                content: input.value,
                level: "Normal",
              });
              input.value = "";
            }
          });
          document
            .getElementById("clear-q-btn")
            .addEventListener("click", () => {
              if (confirm("æ¸…ç©º?")) DataModule.clearQuestions();
            });
          document
            .getElementById("ai-generate-btn")
            .addEventListener("click", () => DataModule.aiGenerate());
          document
            .getElementById("clear-history-btn")
            .addEventListener("click", () => DataModule.clearHistory());
          document
            .getElementById("reset-stats-btn")
            .addEventListener("click", () => DataModule.resetStats());

          // Settings Inputs
          ["range-truth", "range-dare", "range-pass"].forEach((id) => {
            document.getElementById(id).addEventListener("input", () => {
              DataModule.state.settings.segmentCounts = {
                truth: document.getElementById("range-truth").value,
                dare: document.getElementById("range-dare").value,
                pass: document.getElementById("range-pass").value,
              };
              WheelModule.generateSegments();
              WheelModule.draw();
              DataModule.updateSettings();
            });
          });
          document
            .getElementById("check-no-repeat")
            .addEventListener("change", (e) => {
              DataModule.state.settings.noRepeat = e.target.checked;
              DataModule.updateSettings();
            });
          // Import/Export
          document
            .getElementById("btn-export")
            .addEventListener("click", () => DataModule.exportData());
          document
            .getElementById("btn-import")
            .addEventListener("click", () =>
              document.getElementById("file-import").click()
            );
          document
            .getElementById("btn-reset-default")
            .addEventListener("click", () => DataModule.resetToDefault());
          document
            .getElementById("btn-leave-room")
            .addEventListener("click", () => {
              if (confirm("ç¢ºå®šè¦é€€å‡ºæˆ¿é–“å—ï¼Ÿ")) NetworkModule.leaveRoom();
            });
          document
            .getElementById("file-import")
            .addEventListener("change", (e) => {
              const reader = new FileReader();
              reader.onload = (ev) => {
                if (DataModule.importData(ev.target.result)) location.reload();
              };
              if (e.target.files[0]) reader.readAsText(e.target.files[0]);
            });

          // Tabs
          document.querySelectorAll(".diff-tab").forEach((tab) => {
            tab.addEventListener("click", (e) => {
              const parent = tab.parentElement;
              if (parent.id === "diff-selector") {
                parent
                  .querySelectorAll(".diff-tab")
                  .forEach((t) => t.classList.remove("active"));
                e.target.classList.add("active");
                UIModule.renderQuestionList(e.target.dataset.val);
              } else if (parent.id === "timer-mode-selector") {
                parent
                  .querySelectorAll(".diff-tab")
                  .forEach((t) => t.classList.remove("active"));
                e.target.classList.add("active");
                TimerModule.switchMode(e.target.dataset.mode);
              }
            });
          });

          document
            .getElementById("list-difficulty-filter")
            .addEventListener("change", () => {
              UIModule.renderQuestionList();
            });

          // Keyboard
          document.addEventListener("keydown", (e) => {
            if (
              ["input", "select"].includes(
                document.activeElement.tagName.toLowerCase()
              )
            )
              return;
            if (
              e.code === "Space" &&
              document.getElementById("panel-home").classList.contains("active")
            ) {
              e.preventDefault();
              const btn = document.getElementById("spinBtn");
              if (!btn.disabled) WheelModule.spin(true);
            }
            if (e.code === "Escape") this.switchPanel("panel-home");
          });
        },
        switchPanel(id, btn) {
          document
            .querySelectorAll(".panel")
            .forEach((p) => p.classList.remove("active"));
          document.getElementById(id).classList.add("active");
          document
            .querySelectorAll(".nav-btn")
            .forEach((b) => b.classList.remove("active"));
          if (btn) btn.classList.add("active");
          else {
            // Auto active nav
          }
          if (id === "panel-leaderboard") this.renderLeaderboard();
        },
        updateRoleUI() {
          if (NetworkModule.isHost) {
            document
              .querySelectorAll(".host-only")
              .forEach((el) => el.classList.remove("guest-hidden"));
            document
              .querySelectorAll(".guest-hidden-ctrl")
              .forEach((el) => (el.style.display = ""));
            document.getElementById("guest-msg").classList.add("guest-hidden");
            document
              .querySelectorAll(".host-control")
              .forEach((el) => (el.disabled = false));
            this.updateSpinPermission();
          } else {
            document
              .querySelectorAll(".host-only")
              .forEach((el) => el.classList.add("guest-hidden"));
            document
              .getElementById("guest-msg")
              .classList.remove("guest-hidden");
            document
              .querySelectorAll(".host-control")
              .forEach((el) => (el.disabled = true));
            this.updateSpinPermission();
          }
        },
        updateSpinPermission() {
          const btn = document.getElementById("spinBtn");
          if (NetworkModule.roomId === "LOCAL") {
            btn.disabled = false;
            btn.innerText = "é–‹å§‹æŠ½ç±¤";
            return;
          }
          const isMe = NetworkModule.nickname === NetworkModule.nextSpinner;
          if (NetworkModule.isHost || isMe) {
            btn.disabled = false;
            btn.innerText = isMe ? "è¼ªåˆ°ä½ äº†ï¼é–‹å§‹æŠ½ç±¤" : "é–‹å§‹æŠ½ç±¤ (Host)";
          } else {
            btn.disabled = true;
            btn.innerText = NetworkModule.nextSpinner
              ? `ç­‰å¾… ${NetworkModule.nextSpinner} æŠ½ç±¤`
              : "ç­‰å¾…æˆ¿ä¸»é–‹å§‹";
          }
        },
        renderPlayerList() {
          const list = document.getElementById("player-list");
          let html = "";
          DataModule.state.players.forEach((p, i) => {
            const isHost = NetworkModule.isHost;
            const weight = p.weight !== undefined ? p.weight : 1;
            const weightInput = isHost
              ? `<div style="display:flex; align-items:center; margin-right:5px" onclick="event.stopPropagation()">
                   <input type="range" style="width:80px; accent-color:var(--gold); margin-right:5px; cursor:pointer; padding:0" value="${weight}" min="0" max="10" 
                   oninput="document.getElementById('w-val-${i}').innerText=this.value" 
                   onchange="DataModule.updatePlayerWeight(${i}, this.value)">
                   <span id="w-val-${i}" style="width:20px; text-align:center; color:var(--gold); font-weight:bold">${weight}</span>
                 </div>`
              : `<span style="font-size:0.8rem; color:#888; margin-right:5px">æ¬Šé‡: ${weight}</span>`;

            const delBtn = isHost
              ? `<button class="delete-btn" onclick="DataModule.removePlayer(${i})"><i class="material-icons">delete</i></button>`
              : "";

            html += `<div class="list-item">
                <div style="display:flex; align-items:center; flex:1">
                    <i class="material-icons" style="font-size:16px; margin-right:5px">person</i> 
                    <span>${p.name}</span>
                </div>
                <div style="display:flex; align-items:center; gap:5px">${weightInput}${delBtn}</div>
            </div>`;
          });
          list.innerHTML = html;
          document.getElementById("player-count").innerText =
            DataModule.state.players.length;
        },
        renderQuestionList(filterType) {
          if (filterType) this.currentQuestionFilter = filterType;
          const list = document.getElementById("question-list");
          const levelFilter = document.getElementById(
            "list-difficulty-filter"
          ).value;

          list.innerHTML = "";
          DataModule.state.questions.forEach((q, i) => {
            if (
              this.currentQuestionFilter !== "all" &&
              q.type !== this.currentQuestionFilter
            )
              return;
            if (levelFilter !== "all" && q.level !== levelFilter) return;

            // Simplified render
            const delBtn = NetworkModule.isHost
              ? `<button class="delete-btn" onclick="DataModule.removeQuestion(${i})"><i class="material-icons">delete</i></button>`
              : "";
            list.innerHTML += `<div class="list-item ${
              q.type === "truth" ? "truth" : "dare"
            }"><div><span class="tag">${q.type}</span>${
              q.content
            }</div>${delBtn}</div>`;
          });
        },
        renderHistory() {
          const list = document.getElementById("history-list");
          list.innerHTML = "";
          DataModule.state.history.forEach((h) => {
            list.innerHTML += `<div class="list-item ${h.type}"><div><div style="color:var(--gold)">${h.player}</div>${h.content} <span style="font-size:0.7rem; color:#666">${h.time}</span></div></div>`;
          });
        },
        renderLeaderboard() {
          const list = document.getElementById("leaderboard-list");
          list.innerHTML = "";

          const combinedStats = { ...DataModule.state.stats };
          DataModule.state.players.forEach((p) => {
            if (combinedStats[p.name] === undefined) combinedStats[p.name] = 0;
          });

          const stats = Object.entries(combinedStats)
            .map(([k, v]) => ({ name: k, count: v }))
            .sort((a, b) => b.count - a.count);
          stats.forEach((p, i) => {
            let cls =
              i === 0 ? "rank-1" : i === 1 ? "rank-2" : i === 2 ? "rank-3" : "";
            list.innerHTML += `<div class="list-item ${cls}"><span>#${i + 1} ${
              p.name
            }</span><span class="rank-count">${p.count}</span></div>`;
          });
        },
        renderSettingsValues() {
          const s = DataModule.state.settings;
          document.getElementById("range-truth").value = s.segmentCounts.truth;
          document.getElementById("range-dare").value = s.segmentCounts.dare;
          document.getElementById("range-pass").value = s.segmentCounts.pass;
          document.getElementById("speed-range").value = s.speed;
          document.getElementById("duration-range").value = s.duration / 1000;
          document.getElementById("game-difficulty-filter").value =
            s.difficultyFilter;
          document.getElementById("check-no-repeat").checked = !!s.noRepeat;
        },
        showResult(type, content, player) {
          document.getElementById("player-name-slot").innerText = player;
          const box = document.getElementById("display-result");

          let color = "#ccc";
          let grad = "rgba(0,0,0,0.6)";

          if (type === "truth") {
            color = "#4CAF50";
            grad =
              "linear-gradient(135deg, rgba(21, 101, 192, 0.5) 0%, rgba(0, 0, 0, 0.8) 100%)";
          }
          if (type === "dare") {
            color = "#FF5722";
            grad =
              "linear-gradient(135deg, rgba(198, 40, 40, 0.5) 0%, rgba(0, 0, 0, 0.8) 100%)";
          }
          if (type === "pass") {
            color = "#D4AF37";
            grad =
              "linear-gradient(135deg, rgba(212, 175, 55, 0.4) 0%, rgba(0, 0, 0, 0.8) 100%)";
          }

          document.querySelector(".game-info").style.background = grad;
          box.innerHTML = `<span style="color:${color}">[${type.toUpperCase()}]</span> ${content}`;

          EffectModule.triggerConfetti();
        },
        showRoomQR() {
          if (NetworkModule.roomId && NetworkModule.roomId !== "LOCAL") {
            const url = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${NetworkModule.roomId}`;
            document.getElementById("qr-image").src = url;
            document
              .getElementById("qr-display-overlay")
              .classList.remove("hidden");
          }
        },
        showReaction(emoji) {
          const layer = document.getElementById("danmaku-layer");
          const el = document.createElement("div");
          el.className = "danmaku-item";
          el.innerText = emoji;

          // Random position
          const left = Math.random() * 80 + 10; // 10% to 90%
          el.style.left = left + "%";

          // Random size variation
          const size = 1.5 + Math.random();
          el.style.fontSize = size + "rem";

          // Random duration
          const duration = 3 + Math.random() * 2;
          el.style.animationDuration = duration + "s";

          layer.appendChild(el);
          setTimeout(() => {
            el.remove();
          }, duration * 1000);
        },
        toggleReactions() {
          document.getElementById("reaction-menu").classList.toggle("hidden");
        },
      };

      const EffectModule = {
        triggerConfetti() {
          const colors = ["#d4af37", "#f4df87", "#ffffff"];
          confetti({
            particleCount: 100,
            spread: 70,
            origin: { y: 0.6 },
            colors: colors,
          });
        },
      };

      const AudioModule = {
        bgm: null,
        spin: null,
        win: null,
        alarm: null,
        init() {
          this.bgm = document.getElementById("bgm");
          this.spin = document.getElementById("sfx-spin");
          this.win = document.getElementById("sfx-win");
          this.alarm = document.getElementById("sfx-alarm");
        },
        play(k) {
          if (this[k]) this[k].play().catch(() => {});
        },
        stop(k) {
          if (this[k]) {
            this[k].pause();
            this[k].currentTime = 0;
          }
        },
      };

      const TimerModule = {
        mode: "countdown",
        time: 0,
        initialTime: 0,
        interval: null,
        isRunning: false,
        init() {
          this.update();
        },
        switchMode(newMode) {
          this.reset();
          this.mode = newMode;
          const presets = document.getElementById("timer-presets-container");
          if (this.mode === "stopwatch") {
            this.time = 0;
            this.initialTime = 0;
            presets.style.display = "none";
          } else {
            this.time = 0;
            this.initialTime = 0;
            presets.style.display = "flex";
          }
          this.update();
        },
        toggle() {
          if (this.isRunning) this.pause();
          else this.start();
        },
        start() {
          if (this.isRunning) return;
          this.isRunning = true;
          document.getElementById("timer-icon-play").innerText = "pause";
          this.interval = setInterval(() => {
            if (this.mode === "countdown") {
              this.time--;
              if (this.time <= 0) this.finish();
            } else this.time++;
            this.update();
          }, 1000);
        },
        pause() {
          this.isRunning = false;
          clearInterval(this.interval);
          document.getElementById("timer-icon-play").innerText = "play_arrow";
        },
        reset() {
          this.pause();
          this.time = this.initialTime;
          // Smart Reset: è‹¥ç•¶å‰å·²æ˜¯è¨­å®šæ™‚é–“ï¼Œå†æ¬¡é»æ“Šå‰‡æ­¸é›¶(é è¨­å€¼)ï¼›å¦å‰‡é‡ç½®å›è¨­å®šæ™‚é–“
          if (this.time === this.initialTime && this.initialTime > 0) {
            this.time = 0;
            this.initialTime = 0;
          } else {
            this.time = this.initialTime;
          }
          document
            .getElementById("timer-display")
            .classList.remove("timer-blink");
          document.body.classList.remove("shake-screen");
          this.update();
        },
        finish() {
          this.pause();
          document.getElementById("timer-display").classList.add("timer-blink");
          document.body.classList.add("shake-screen");
          if (navigator.vibrate) navigator.vibrate([500, 200, 500, 200, 500]);
          AudioModule.play("alarm");
          // Stop shaking after 5 seconds
          setTimeout(() => {
            document.body.classList.remove("shake-screen");
          }, 5000);
        },
        addTime(s) {
          if (this.mode === "countdown") {
            this.time += s;
            this.initialTime = this.time;
            this.update();
          }
        },
        update() {
          const m = Math.floor(this.time / 60)
            .toString()
            .padStart(2, "0");
          const s = (this.time % 60).toString().padStart(2, "0");
          document.getElementById("timer-display").innerText = `${m}:${s}`;
        },
      };

      const ScannerModule = {
        scanner: null,
        start() {
          document.getElementById("scanner-overlay").classList.remove("hidden");
          setTimeout(() => {
            if (!this.scanner) {
              this.scanner = new Html5Qrcode("reader");
            }
            this.scanner
              .start(
                { facingMode: "environment" },
                { fps: 10, qrbox: { width: 250, height: 250 } },
                (decodedText) => {
                  this.stop();
                  document.getElementById("room-code-input").value =
                    decodedText;
                  if (/^\d{6}$/.test(decodedText)) NetworkModule.joinRoom();
                },
                (errorMessage) => {}
              )
              .catch((err) => {
                alert("ç„¡æ³•å•Ÿå‹•ç›¸æ©Ÿ");
                this.stop();
              });
          }, 100);
        },
        stop() {
          document.getElementById("scanner-overlay").classList.add("hidden");
          if (this.scanner)
            this.scanner
              .stop()
              .then(() => this.scanner.clear())
              .catch(() => {});
        },
      };

      window.onload = () => {
        DataModule.init();
        UIModule.init();
        TimerModule.init();
      };
    </script>
  </body>
</html>
